<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ë‚ ì§œì¡ì â€” ì•½ì† ë‚ ì§œ ì¡°ìœ¨</title>
  
  <!-- Open Graph / ì¹´ì¹´ì˜¤í†¡ ë“± -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="ë‚ ì§œì¡ì (Click!)" />
  <meta property="og:description" content="ì•½ì† ë‚ ì§œë¥¼ ì¡°ìœ¨í•˜ëŠ” ê°€ì¥ í¸í•œ ë°©ë²•" />
  <meta property="og:image" content="https://hong4137.github.io/datepicker/og-image-v4.png" />
  <meta property="og:url" content="https://hong4137.github.io/datepicker/" />
  
  <!-- Twitter Card (summary = ì‘ì€ ì´ë¯¸ì§€ + í…ìŠ¤íŠ¸) -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="ë‚ ì§œì¡ì (Click!)" />
  <meta name="twitter:description" content="ì•½ì† ë‚ ì§œë¥¼ ì¡°ìœ¨í•˜ëŠ” ê°€ì¥ í¸í•œ ë°©ë²•" />
  <meta name="twitter:image" content="https://hong4137.github.io/datepicker/og-image-v4.png" />
  
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body, #root { height: 100%; }
    body {
      font-family: 'Pretendard', 'Apple SD Gothic Neo', -apple-system, sans-serif;
      background: linear-gradient(145deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
      color: #e2e8f0;
      -webkit-font-smoothing: antialiased;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    input:focus { border-color: #38bdf8 !important; outline: none; }
    button { -webkit-appearance: none; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SUPABASE ì„¤ì • (Apps Script ëŒ€ì²´)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const SUPABASE_URL = "https://ptyfrcfizmtlyqjjetjw.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0eWZyY2Zpem10bHlxampldGp3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyMDY0NTAsImV4cCI6MjA4NTc4MjQ1MH0.L8207Uo0DlgkiXTkF9vHUOuX6NP8SfJcEpk9vFAPKBQ";
    const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    function generateId() {
      const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let id = '';
      for (let i = 0; i < 8; i++) id += chars.charAt(Math.floor(Math.random() * chars.length));
      return id;
    }

    // â”€â”€ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function parseDate(d) {
      if (!d) return null;
      if (typeof d === "string") {
        if (d.match(/^\d{4}-\d{2}-\d{2}$/)) { const [y,m,day] = d.split("-").map(Number); return new Date(y,m-1,day); }
        return new Date(d);
      }
      return new Date(d);
    }
    function fmtDate(date) {
      return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,"0")}-${String(date.getDate()).padStart(2,"0")}`;
    }
    function fmtDisplay(date) {
      const days = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
      return `${date.getMonth()+1}/${date.getDate()}(${days[date.getDay()]})`;
    }
    function getDaysInMonth(y,m) { return new Date(y,m+1,0).getDate(); }
    function getFirstDayOfMonth(y,m) { return new Date(y,m,1).getDay(); }
    function isWeekend(y,m,d) { const day = new Date(y,m,d).getDay(); return day===0||day===6; }

    // 2026ë…„ í•œêµ­ ê³µíœ´ì¼ (ëŒ€ì²´ê³µíœ´ì¼ í¬í•¨)
    const KR_HOLIDAYS = {
      "2026-01-01": "ì‹ ì •",
      "2026-02-16": "ì„¤ë‚  ì—°íœ´",
      "2026-02-17": "ì„¤ë‚ ",
      "2026-02-18": "ì„¤ë‚  ì—°íœ´",
      "2026-03-01": "ì‚¼ì¼ì ˆ",
      "2026-03-02": "ì‚¼ì¼ì ˆ ëŒ€ì²´ê³µíœ´ì¼",
      "2026-05-05": "ì–´ë¦°ì´ë‚ ",
      "2026-05-24": "ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ",
      "2026-05-25": "ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚  ëŒ€ì²´ê³µíœ´ì¼",
      "2026-06-06": "í˜„ì¶©ì¼",
      "2026-08-15": "ê´‘ë³µì ˆ",
      "2026-08-17": "ê´‘ë³µì ˆ ëŒ€ì²´ê³µíœ´ì¼",
      "2026-09-24": "ì¶”ì„ ì—°íœ´",
      "2026-09-25": "ì¶”ì„",
      "2026-09-26": "ì¶”ì„ ì—°íœ´",
      "2026-10-03": "ê°œì²œì ˆ",
      "2026-10-05": "ê°œì²œì ˆ ëŒ€ì²´ê³µíœ´ì¼",
      "2026-10-09": "í•œê¸€ë‚ ",
      "2026-12-25": "í¬ë¦¬ìŠ¤ë§ˆìŠ¤",
    };

    function getHolidayName(dateStr) { return KR_HOLIDAYS[dateStr] || null; }
    function isHoliday(dateStr) { return !!KR_HOLIDAYS[dateStr]; }
    function isOff(y,m,d) {
      // ì£¼ë§ì´ê±°ë‚˜ ê³µíœ´ì¼ì´ë©´ ì‰¬ëŠ” ë‚ 
      const dateStr = fmtDate(new Date(y,m,d));
      return isWeekend(y,m,d) || isHoliday(dateStr);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SUPABASE API í•¨ìˆ˜ë“¤
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    async function apiCall(params) {
      // ê¸°ì¡´ apiCall í˜¸í™˜ìš© ë˜í¼
      const action = params.action;
      
      switch (action) {
        case 'createGroup':
          return await apiCreateGroup(params.creator, params.members, params.focusRanges, params.groupName, params.email);
        case 'getGroup':
          return await apiGetGroup(params.groupId);
        case 'saveVotes':
          return await apiSaveVotes(params.groupId, params.userName, JSON.parse(params.votes));
        case 'getMyVotes':
          return await apiGetMyVotes(params.groupId, params.userName);
        case 'getVoteStatus':
          return await apiGetVoteStatus(params.groupId);
        case 'closeGroup':
          const excluded = params.excluded ? params.excluded.split(',').filter(Boolean) : [];
          return await apiCloseGroup(params.groupId, excluded, params.vip);
        case 'updateFocus':
          return await apiUpdateFocus(params.groupId, JSON.parse(params.focusRanges || '[]'));
        case 'getResult':
          return await apiGetResult(params.groupId, params.vip);
        case 'confirmDate':
          return await apiConfirmDate(params.groupId, params.date);
        default:
          return { error: 'Unknown action' };
      }
    }

    async function apiCreateGroup(creator, membersStr, focusRangesStr, groupName, email) {
      const groupId = generateId();
      const today = new Date();
      const endDate = new Date(today);
      endDate.setDate(endDate.getDate() + 90);

      const members = membersStr.split(',').map(s => s.trim()).filter(Boolean);
      if (!members.includes(creator)) members.unshift(creator);
      
      let focusRanges = [];
      try { focusRanges = JSON.parse(focusRangesStr || '[]'); } catch(e) {}

      const { data, error } = await db.from('groups').insert({
        group_id: groupId,
        creator,
        members,
        date_start: fmtDate(today),
        date_end: fmtDate(endDate),
        focus_ranges: focusRanges,
        group_name: groupName || null,
        email: email || null,
        meal_type: 'dinner'
      }).select().single();

      if (error) return { error: error.message };
      return { success: true, groupId: data.group_id };
    }

    async function apiGetGroup(groupId) {
      const { data, error } = await db.from('groups').select('*').eq('group_id', groupId).single();
      if (error) return { error: 'Group not found' };
      return {
        success: true,
        group: {
          groupId: data.group_id,
          creator: data.creator,
          members: data.members,
          dateStart: data.date_start,
          dateEnd: data.date_end,
          status: data.status,
          excluded: data.excluded || [],
          focusRanges: data.focus_ranges || [],
          vip: data.vip,
          confirmedDate: data.confirmed_date,
          groupName: data.group_name,
          email: data.email,
          emailSent: data.email_sent,
          mealType: data.meal_type
        }
      };
    }

    async function apiGetMyVotes(groupId, userName) {
      const { data, error } = await db.from('votes').select('*').eq('group_id', groupId).eq('user_name', userName);
      if (error) return { error: error.message };
      return { success: true, votes: data.map(v => ({ date: v.vote_date, voteType: v.vote_type })) };
    }

    // ì´ë©”ì¼ ë°œì†¡ í•¨ìˆ˜ (Apps Script ì‚¬ìš©)
    const EMAIL_API_URL = "https://script.google.com/macros/s/AKfycbwTHSt1Lbz-AUzKU8Y27kLcNYhQC-CMVMsaIlPlR4oroXzwUPvDfrRBt2jeBhJMExjx/exec";
    
    async function sendEmailNotification(to, groupName, groupId, memberCount, confirmedDate) {
      if (!to) return; // ì´ë©”ì¼ ì—†ìœ¼ë©´ ìŠ¤í‚µ
      
      try {
        const params = new URLSearchParams({
          action: 'sendEmail',
          to,
          groupName: groupName || '',
          groupId,
          memberCount: memberCount || '',
        });
        if (confirmedDate) params.append('confirmedDate', confirmedDate);
        
        const response = await fetch(`${EMAIL_API_URL}?${params.toString()}`);
        const result = await response.json();
        console.log('Email sent:', result);
        return result;
      } catch (err) {
        console.error('Email error:', err);
      }
    }

    async function apiSaveVotes(groupId, userName, votes) {
      await db.from('votes').delete().eq('group_id', groupId).eq('user_name', userName);
      if (votes.length > 0) {
        const newVotes = votes.map(v => ({ group_id: groupId, user_name: userName, vote_date: v.date, vote_type: v.voteType }));
        const { error } = await db.from('votes').insert(newVotes);
        if (error) return { error: error.message };
      }
      
      // ì „ì› íˆ¬í‘œ ì™„ë£Œ ì²´í¬ ë° ì´ë©”ì¼ ë°œì†¡
      const groupResult = await apiGetGroup(groupId);
      if (groupResult.success && groupResult.group.email && !groupResult.group.emailSent) {
        const group = groupResult.group;
        const activeMembers = group.members.filter(m => !group.excluded.includes(m));
        const { data: votesData } = await db.from('votes').select('user_name').eq('group_id', groupId);
        const votedUsers = new Set(votesData?.map(v => v.user_name) || []);
        const allVoted = activeMembers.every(m => votedUsers.has(m));
        
        if (allVoted) {
          // ì´ë©”ì¼ ë°œì†¡
          await sendEmailNotification(group.email, group.groupName, groupId, activeMembers.length);
          // email_sent í”Œë˜ê·¸ ì—…ë°ì´íŠ¸
          await db.from('groups').update({ email_sent: true }).eq('group_id', groupId);
        }
      }
      
      return { success: true, saved: votes.length };
    }

    async function apiGetVoteStatus(groupId) {
      const groupResult = await apiGetGroup(groupId);
      if (groupResult.error) return groupResult;
      const group = groupResult.group;
      const activeMembers = group.members.filter(m => !group.excluded.includes(m));
      const { data: votesData } = await db.from('votes').select('user_name').eq('group_id', groupId);
      const votedUsers = new Set(votesData?.map(v => v.user_name) || []);
      const status = activeMembers.map(m => ({ name: m, voted: votedUsers.has(m) }));
      return { success: true, totalMembers: activeMembers.length, votedCount: status.filter(s => s.voted).length, members: status };
    }

    async function apiCloseGroup(groupId, excludedMembers, vip) {
      const { error } = await db.from('groups').update({ status: 'closed', excluded: excludedMembers, vip: vip || null }).eq('group_id', groupId);
      if (error) return { error: error.message };
      return { success: true, excluded: excludedMembers, vip: vip || '' };
    }

    async function apiUpdateFocus(groupId, focusRanges) {
      const { error } = await db.from('groups').update({ focus_ranges: focusRanges }).eq('group_id', groupId);
      if (error) return { error: error.message };
      return { success: true, focusRanges };
    }

    async function apiConfirmDate(groupId, date) {
      const { error } = await db.from('groups').update({ confirmed_date: date }).eq('group_id', groupId);
      if (error) return { error: error.message };
      
      // ë‚ ì§œ í™•ì • ì´ë©”ì¼ ë°œì†¡
      const groupResult = await apiGetGroup(groupId);
      if (groupResult.success && groupResult.group.email) {
        const group = groupResult.group;
        const activeMembers = group.members.filter(m => !group.excluded.includes(m));
        await sendEmailNotification(group.email, group.groupName, groupId, activeMembers.length, date);
      }
      
      return { success: true, confirmedDate: date };
    }

    async function apiGetResult(groupId, vip) {
      const groupResult = await apiGetGroup(groupId);
      if (groupResult.error) return groupResult;
      const group = groupResult.group;
      if (!vip && group.vip) vip = group.vip;
      const activeMembers = group.members.filter(m => !group.excluded.includes(m));
      const totalMembers = activeMembers.length;
      const hasVip = vip && activeMembers.includes(vip);
      const focusRanges = group.focusRanges || [];
      const hasFocus = focusRanges.length > 0;
      const isInFocus = (dateStr) => focusRanges.some(r => dateStr >= r.s && dateStr <= r.e);

      const { data: votesData } = await db.from('votes').select('*').eq('group_id', groupId);
      const dateVotes = {};
      (votesData || []).forEach(v => {
        if (!activeMembers.includes(v.user_name)) return;
        const date = v.vote_date;
        if (!dateVotes[date]) dateVotes[date] = { preferred: [], unavailable: [] };
        if (v.vote_type === 'preferred') dateVotes[date].preferred.push(v.user_name);
        else if (v.vote_type === 'unavailable') dateVotes[date].unavailable.push(v.user_name);
      });

      const allDates = new Set(Object.keys(dateVotes));
      if (hasFocus) {
        focusRanges.forEach(r => {
          let cur = new Date(r.s + 'T00:00:00');
          const end = new Date(r.e + 'T00:00:00');
          while (cur <= end) { allDates.add(fmtDate(cur)); cur.setDate(cur.getDate() + 1); }
        });
      }

      const focusTier1 = [], focusTier2 = [], focusTier3 = [];
      const outerTier1 = [], outerTier2 = [], outerTier3 = [];

      for (const date of allDates) {
        if (isOffDay(date)) continue;
        const v = dateVotes[date] || { preferred: [], unavailable: [] };
        if (hasVip && v.unavailable.includes(vip)) continue;
        if (hasVip && !v.preferred.includes(vip)) continue;
        const preferredCount = v.preferred.length;
        const unavailableCount = v.unavailable.length;
        const neutralUsers = activeMembers.filter(m => !v.preferred.includes(m) && !v.unavailable.includes(m));
        const isFocus = hasFocus && isInFocus(date);
        const entry = { date, preferred: preferredCount, unavailable: unavailableCount, unavailableUsers: v.unavailable, neutral: neutralUsers.length, neutralUsers };

        if (unavailableCount === 0 && preferredCount === totalMembers) (isFocus ? focusTier1 : outerTier1).push(entry);
        else if (unavailableCount === 0) (isFocus ? focusTier2 : outerTier2).push(entry);
        else (isFocus ? focusTier3 : outerTier3).push(entry);
      }

      const findBest = (f, o) => f.length > 0 ? { data: f, fromFocus: true } : o.length > 0 ? { data: o, fromFocus: false } : null;

      let best = findBest(focusTier1, outerTier1);
      if (best) { best.data.sort((a, b) => a.date.localeCompare(b.date)); return { success: true, tier: 1, message: hasVip ? vip + 'ë‹˜ ì¤‘ì‹¬ Â· ëª¨ë‘ê°€ ì„ í˜¸í•˜ëŠ” ë‚ ' : 'ëª¨ë‘ê°€ ì„ í˜¸í•˜ëŠ” ë‚ ', fromFocus: best.fromFocus, dates: best.data, totalMembers, vip: vip || '' }; }

      best = findBest(focusTier2, outerTier2);
      if (best) { best.data.sort((a, b) => b.preferred - a.preferred || a.date.localeCompare(b.date)); const topPref = best.data[0].preferred; return { success: true, tier: 2, message: hasVip ? vip + 'ë‹˜ ì¤‘ì‹¬ Â· ì „ì› ê°€ëŠ¥í•œ ë‚  ì¤‘ ìµœì ' : 'ì „ì› ê°€ëŠ¥í•œ ë‚  ì¤‘ ìµœì ', fromFocus: best.fromFocus, dates: best.data.filter(d => d.preferred === topPref), totalMembers, vip: vip || '' }; }

      best = findBest(focusTier3, outerTier3);
      if (best) { best.data.sort((a, b) => a.unavailable - b.unavailable || b.preferred - a.preferred || a.date.localeCompare(b.date)); const top = best.data[0]; return { success: true, tier: 3, message: hasVip ? vip + 'ë‹˜ ì¤‘ì‹¬ Â· ì–‘ë³´ê°€ í•„ìš”í•œ ë‚ ' : 'ì–‘ë³´ê°€ í•„ìš”í•œ ë‚ ', fromFocus: best.fromFocus, dates: best.data.filter(d => d.unavailable === top.unavailable && d.preferred === top.preferred), totalMembers, vip: vip || '' }; }

      return { success: true, tier: 0, message: 'íˆ¬í‘œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', dates: [], totalMembers };
    }

    function isOffDay(dateStr) {
      const d = new Date(dateStr + 'T00:00:00');
      return d.getDay() === 0 || d.getDay() === 6 || !!KR_HOLIDAYS[dateStr];
    }

    const VOTE_COLORS = {
      preferred: { bg: "#22c55e", text: "#fff", label: "ì„ í˜¸í•˜ëŠ” ë‚ ", emoji: "â™¥" },
      unavailable: { bg: "#ef4444", text: "#fff", label: "ì ˆëŒ€ ì•ˆë˜ëŠ” ë‚ ", emoji: "âœ•" },
    };
    const VOTE_CYCLE = [null, "preferred", "unavailable"];

    const inputStyle = {
      width: "100%", padding: "12px 14px", borderRadius: 10,
      border: "1px solid #334155", background: "#0f172a",
      color: "#e2e8f0", fontSize: 15, fontFamily: "inherit", outline: "none", boxSizing: "border-box",
    };

    // â”€â”€ ê³µí†µ ì»´í¬ë„ŒíŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function Card({ children, style }) {
      return <div style={{
        background: "rgba(30,41,59,0.8)", border: "1px solid #334155",
        borderRadius: 16, padding: 24, marginBottom: 16,
        backdropFilter: "blur(8px)", animation: "fadeIn 0.3s ease", ...style,
      }}>{children}</div>;
    }

    function Button({ children, onClick, disabled, variant="primary", style }) {
      const styles = {
        primary: { background: "linear-gradient(135deg,#0ea5e9,#38bdf8)", color: "#fff" },
        secondary: { background: "rgba(51,65,85,0.8)", color: "#cbd5e1", border: "1px solid #475569" },
        danger: { background: "linear-gradient(135deg,#dc2626,#ef4444)", color: "#fff" },
      };
      return <button onClick={onClick} disabled={disabled} style={{
        width: "100%", padding: "14px 20px", borderRadius: 12, border: "none",
        fontSize: 15, fontWeight: 700, cursor: disabled ? "default" : "pointer",
        opacity: disabled ? 0.5 : 1, transition: "all 0.2s", fontFamily: "inherit",
        ...styles[variant], ...style,
      }}>{children}</button>;
    }

    function Header() {
      const handleHome = () => { window.location.href = window.location.pathname; };
      return (
        <div style={{ textAlign: "center", padding: "20px 0 8px" }}>
          <div onClick={handleHome} style={{ cursor: "pointer", display: "inline-block" }}>
            <div style={{ fontSize: 24, fontWeight: 900, background: "linear-gradient(135deg,#38bdf8,#818cf8)", WebkitBackgroundClip: "text", WebkitTextFillColor: "transparent" }}>ë‚ ì§œì¡ì</div>
            <div style={{ fontSize: 12, color: "#64748b", marginTop: 2 }}>ì‰½ê³  ë¹ ë¥¸ ì•½ì† ë‚ ì§œ ì¡°ìœ¨</div>
          </div>
        </div>
      );
    }

    function LoadingSpinner() {
      return <div style={{ textAlign: "center", padding: 60 }}>
        <div style={{ width: 36, height: 36, border: "3px solid #334155", borderTop: "3px solid #38bdf8", borderRadius: "50%", animation: "spin 0.8s linear infinite", margin: "0 auto" }} />
      </div>;
    }

    function ErrorScreen({ message }) {
      return <Card><div style={{ textAlign: "center", padding: 24 }}>
        <div style={{ fontSize: 40, marginBottom: 12 }}>âš ï¸</div>
        <div style={{ fontSize: 16, color: "#f87171", marginBottom: 8 }}>{message}</div>
        <div style={{ fontSize: 13, color: "#64748b" }}>ì•½ì†ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</div>
        <button onClick={() => { window.location.href = window.location.pathname; }} style={{
          marginTop: 16, padding: "12px 24px", borderRadius: 10,
          background: "rgba(51,65,85,0.8)", border: "1px solid #475569",
          color: "#cbd5e1", fontSize: 14, cursor: "pointer", fontFamily: "inherit",
        }}>ìƒˆ ì•½ì† ë§Œë“¤ê¸°</button>
      </div></Card>;
    }

    // â”€â”€ ê·¸ë£¹ ìƒì„± í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function CreateScreen({ form, setForm, onSubmit, loading }) {
      const [selectingFocus, setSelectingFocus] = useState(false);
      const [focusStep, setFocusStep] = useState(0);
      const [tempStart, setTempStart] = useState("");
      const [pendingRange, setPendingRange] = useState(null); // í™•ì¸ ëŒ€ê¸° ì¤‘ì¸ êµ¬ê°„
      const [nameEnabled, setNameEnabled] = useState(false);
      const [emailEnabled, setEmailEnabled] = useState(false);
      const confirmRef = React.useRef(null);

      const today = new Date(); today.setHours(0,0,0,0);
      const maxDate = new Date(today); maxDate.setDate(maxDate.getDate() + 90);

      const handleFocusDateClick = (dateStr) => {
        if (focusStep === 0) {
          setTempStart(dateStr);
          setFocusStep(1);
        } else {
          let s = tempStart, e = dateStr;
          if (e < s) { const t = s; s = e; e = t; }
          // ë°”ë¡œ ì €ì¥í•˜ì§€ ì•Šê³  í™•ì¸ í™”ë©´ìœ¼ë¡œ
          setPendingRange({ s, e });
          setFocusStep(2); // í™•ì¸ ë‹¨ê³„
          // í™•ì¸ ë©”ì‹œì§€ë¡œ ìŠ¤í¬ë¡¤
          setTimeout(() => {
            if (confirmRef.current) {
              confirmRef.current.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
          }, 100);
        }
      };

      const confirmRange = () => {
        if (pendingRange) {
          const newRanges = [...(form.focusRanges || []), pendingRange];
          setForm({ ...form, focusRanges: newRanges });
        }
        setPendingRange(null);
        setTempStart("");
        setFocusStep(0);
        setSelectingFocus(false);
      };

      const resetRange = () => {
        setPendingRange(null);
        setTempStart("");
        setFocusStep(0);
        // ë‹¬ë ¥ì€ ìœ ì§€ (selectingFocusëŠ” true ìœ ì§€)
      };

      const removeRange = (idx) => {
        const newRanges = form.focusRanges.filter((_, i) => i !== idx);
        setForm({ ...form, focusRanges: newRanges });
      };

      const months = [];
      const cur = new Date(today.getFullYear(), today.getMonth(), 1);
      while (cur <= maxDate) {
        months.push({ year: cur.getFullYear(), month: cur.getMonth() });
        cur.setMonth(cur.getMonth() + 1);
      }

      const hasRanges = form.focusRanges && form.focusRanges.length > 0;

      return (
        <Card>
          <div style={{ fontSize: 18, fontWeight: 700, marginBottom: 20 }}>ìƒˆ ì•½ì† ë§Œë“¤ê¸°</div>

          {/* ì ì‹¬/ì €ë… ì„ íƒ */}
          <div style={{ marginBottom: 16 }}>
            <label style={{ fontSize: 13, color: "#94a3b8", display: "block", marginBottom: 6 }}>ì•½ì† ì¢…ë¥˜</label>
            <div style={{ display: "flex", gap: 10 }}>
              {[
                { value: "dinner", emoji: "ğŸŒ™", label: "ì €ë… ì•½ì†" },
                { value: "lunch", emoji: "â˜€ï¸", label: "ì ì‹¬ ì•½ì†" },
              ].map(opt => {
                const selected = (form.mealType || "dinner") === opt.value;
                return (
                  <button key={opt.value} onClick={() => setForm({...form, mealType: opt.value})} style={{
                    flex: 1, padding: "14px 12px", borderRadius: 12,
                    border: selected ? "2px solid #38bdf8" : "1px solid #334155",
                    background: selected ? "rgba(56,189,248,0.1)" : "rgba(15,23,42,0.4)",
                    color: selected ? "#e2e8f0" : "#64748b",
                    fontSize: 15, fontWeight: selected ? 700 : 500,
                    cursor: "pointer", fontFamily: "inherit", transition: "all 0.15s",
                    display: "flex", alignItems: "center", justifyContent: "center", gap: 8,
                  }}>
                    <span style={{ fontSize: 20 }}>{opt.emoji}</span>
                    {opt.label}
                  </button>
                );
              })}
            </div>
          </div>

          <div style={{ marginBottom: 16 }}>
            <label style={{ fontSize: 13, color: "#94a3b8", display: "block", marginBottom: 6 }}>ë‚´ ì´ë¦„ (ë°œí–‰ì)</label>
            <input type="text" value={form.creator} onChange={e => setForm({...form, creator: e.target.value})} placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" style={inputStyle} />
          </div>
          <div style={{ marginBottom: 16 }}>
            <label style={{ fontSize: 13, color: "#94a3b8", display: "block", marginBottom: 6 }}>ì°¸ì—¬ì ì´ë¦„ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
            <input type="text" value={form.members} onChange={e => setForm({...form, members: e.target.value})} placeholder="ë¯¼ìˆ˜, ì˜í¬, ì² ìˆ˜" style={inputStyle} />
            <div style={{ fontSize: 12, color: "#64748b", marginTop: 6 }}>ë³¸ì¸ ì´ë¦„ì€ ìë™ìœ¼ë¡œ í¬í•¨ë©ë‹ˆë‹¤</div>
          </div>

          {/* í•µì‹¬ êµ¬ê°„ (ë³µìˆ˜) */}
          <div style={{ marginBottom: 24 }}>
            <label style={{ fontSize: 15, color: "#38bdf8", fontWeight: 700, display: "block", marginBottom: 8 }}>ğŸ“… í•µì‹¬ êµ¬ê°„</label>

            {/* ê¸°ì¡´ êµ¬ê°„ ë¦¬ìŠ¤íŠ¸ */}
            {hasRanges && (
              <div style={{ display: "flex", flexDirection: "column", gap: 8, marginBottom: 8 }}>
                {form.focusRanges.map((r, idx) => (
                  <div key={idx} style={{ display: "flex", alignItems: "center", gap: 10 }}>
                    <div style={{ flex: 1, padding: "10px 14px", borderRadius: 10, background: "rgba(56,189,248,0.1)", border: "1px solid rgba(56,189,248,0.3)", fontSize: 14, color: "#38bdf8", fontWeight: 600 }}>
                      {fmtDisplay(parseDate(r.s))} ~ {fmtDisplay(parseDate(r.e))}
                    </div>
                    <button onClick={() => removeRange(idx)} style={{ background: "none", border: "none", color: "#64748b", fontSize: 18, cursor: "pointer", flexShrink: 0 }}>âœ•</button>
                  </div>
                ))}
              </div>
            )}

            {/* êµ¬ê°„ ì¶”ê°€ ë²„íŠ¼ / ì„ íƒ ì¤‘ ìº˜ë¦°ë” */}
            {!selectingFocus ? (
              <button onClick={() => { setSelectingFocus(true); setFocusStep(0); setTempStart(""); }} style={{
                width: "100%", padding: "12px 14px", borderRadius: 10, border: "1px dashed #475569",
                background: "transparent", color: "#94a3b8", fontSize: 14, cursor: "pointer", fontFamily: "inherit",
              }}>
                {hasRanges ? "ï¼‹ í•µì‹¬ êµ¬ê°„ ì¶”ê°€" : "ğŸ“… ìº˜ë¦°ë”ì—ì„œ êµ¬ê°„ ì„ íƒí•˜ê¸°"}
              </button>
            ) : (
              <div>
                {focusStep === 2 && pendingRange && (
                  /* í™•ì¸ ë©”ì‹œì§€ - ìº˜ë¦°ë” ìœ„ì— í‘œì‹œ */
                  <div ref={confirmRef} style={{ 
                    background: "rgba(15,23,42,0.95)", 
                    border: "1px solid #38bdf8",
                    borderRadius: 12, 
                    padding: "16px 20px", 
                    marginBottom: 12,
                    textAlign: "center",
                  }}>
                    <div style={{ fontSize: 15, color: "#e2e8f0", marginBottom: 14, lineHeight: 1.6 }}>
                      <span style={{ color: "#38bdf8", fontWeight: 700 }}>{fmtDisplay(parseDate(pendingRange.s))}</span>
                      <span style={{ color: "#94a3b8" }}> ë¶€í„° </span>
                      <span style={{ color: "#38bdf8", fontWeight: 700 }}>{fmtDisplay(parseDate(pendingRange.e))}</span>
                      <span style={{ color: "#94a3b8" }}> ê¹Œì§€</span>
                      <br />
                      <span style={{ color: "#94a3b8" }}>ê¸°ê°„ì„ ìœ„ì£¼ë¡œ íˆ¬í‘œë¥¼ ë°›ì„ê¹Œìš”?</span>
                    </div>
                    <div style={{ display: "flex", gap: 10 }}>
                      <button onClick={resetRange} style={{
                        flex: 1, padding: "12px", borderRadius: 10, border: "1px solid #475569",
                        background: "transparent", color: "#94a3b8", fontSize: 14, fontWeight: 600,
                        cursor: "pointer", fontFamily: "inherit",
                      }}>ë‹¤ì‹œ ì„ íƒ</button>
                      <button onClick={confirmRange} style={{
                        flex: 1, padding: "12px", borderRadius: 10, border: "none",
                        background: "linear-gradient(135deg,#0ea5e9,#38bdf8)", color: "#fff",
                        fontSize: 14, fontWeight: 700, cursor: "pointer", fontFamily: "inherit",
                      }}>ë„¤, í™•ì¸</button>
                    </div>
                  </div>
                )}
                {focusStep !== 2 && (
                  <div style={{ fontSize: 13, color: "#38bdf8", marginBottom: 8, fontWeight: 600 }}>
                    {focusStep === 0 ? "â–¸ ì‹œì‘ì¼ì„ ì„ íƒí•˜ì„¸ìš”" : "â–¸ ì¢…ë£Œì¼ì„ ì„ íƒí•˜ì„¸ìš”"}
                  </div>
                )}
                {tempStart && focusStep === 1 && (
                  <div style={{ fontSize: 13, color: "#94a3b8", marginBottom: 8 }}>
                    ì„ íƒ: {fmtDisplay(parseDate(tempStart))} ~ ...
                  </div>
                )}
                {months.map(({year, month}) => (
                  <MiniMonthCalendar key={`${year}-${month}`} year={year} month={month}
                    today={today} maxDate={maxDate}
                    focusRanges={[...(form.focusRanges || []), ...(pendingRange ? [pendingRange] : (tempStart ? [{s: tempStart, e: tempStart}] : []))]}
                    focusStep={focusStep}
                    onDateClick={focusStep !== 2 ? handleFocusDateClick : undefined} />
                ))}
                <button onClick={() => { setSelectingFocus(false); setFocusStep(0); setTempStart(""); setPendingRange(null); }} style={{
                  width: "100%", padding: "10px", borderRadius: 10, border: "1px solid #475569",
                  background: "transparent", color: "#94a3b8", fontSize: 13, cursor: "pointer", fontFamily: "inherit", marginTop: 8,
                }}>ì·¨ì†Œ</button>
              </div>
            )}
            <div style={{ fontSize: 13, color: "#fbbf24", marginTop: 8, fontWeight: 600 }}>
              ğŸ’¡ "2ì›” 3~4ì§¸ì£¼ì— ë³´ì" ê°™ì€ ëŒ€ëµì ì¸ ê¸°ê°„ì„ ì„¤ì •í•˜ì„¸ìš”
            </div>
          </div>

          <Button onClick={onSubmit} disabled={loading || !form.creator.trim() || !form.members.trim() || !hasRanges}>
            {loading ? "ìƒì„± ì¤‘..." : "ì•½ì† ë§Œë“¤ê¸°"}
          </Button>

          {/* ì„ íƒ ì˜µì…˜ */}
          <div style={{ marginTop: 20, paddingTop: 20, borderTop: "1px solid rgba(71,85,105,0.3)" }}>
            <div style={{ fontSize: 12, color: "#64748b", marginBottom: 12, letterSpacing: "0.5px" }}>ì„ íƒ ì˜µì…˜</div>

            {/* ëª¨ì„ ì´ë¦„ */}
            <div style={{ marginBottom: 8 }}>
              <div onClick={() => { setNameEnabled(!nameEnabled); if (nameEnabled) setForm({...form, groupName: ""}); }}
                style={{
                  display: "flex", alignItems: "center", gap: 10, cursor: "pointer",
                  padding: "12px 14px", borderRadius: 12,
                  background: nameEnabled ? "rgba(56,189,248,0.06)" : "transparent",
                  border: nameEnabled ? "1px solid rgba(56,189,248,0.2)" : "1px solid transparent",
                  transition: "all 0.2s",
                }}>
                <div style={{
                  width: 40, height: 22, borderRadius: 11, padding: 2, flexShrink: 0,
                  background: nameEnabled ? "#0ea5e9" : "#334155",
                  transition: "background 0.2s", display: "flex", alignItems: "center",
                }}>
                  <div style={{ width: 18, height: 18, borderRadius: "50%", background: "#fff",
                    transform: nameEnabled ? "translateX(18px)" : "translateX(0)", transition: "transform 0.2s" }} />
                </div>
                <div>
                  <div style={{ fontSize: 14, color: "#e2e8f0", fontWeight: 600 }}>âœï¸ ëª¨ì„ ì´ë¦„ ì„¤ì •</div>
                  <div style={{ fontSize: 12, color: "#64748b", marginTop: 2 }}>ì•½ì†ì— ì´ë¦„ì„ ë¶™ì—¬ êµ¬ë¶„í•˜ê¸° ì‰½ê²Œ</div>
                </div>
              </div>
              {nameEnabled && (
                <div style={{ marginTop: 10, paddingLeft: 4 }}>
                  <input type="text" value={form.groupName} onChange={e => setForm({...form, groupName: e.target.value})}
                    placeholder="ì˜ˆ: ëŒ€í•™ ë™ê¸° 2ì›” ëª¨ì„" style={inputStyle} />
                  <div style={{ fontSize: 12, color: "#64748b", marginTop: 6 }}>êµ¬ê¸€ ìº˜ë¦°ë” ì œëª©ì— ìë™ìœ¼ë¡œ ì…ë ¥ë©ë‹ˆë‹¤</div>
                </div>
              )}
            </div>

            {/* ë§ˆê° ì•Œë¦¼ */}
            <div>
              <div onClick={() => { setEmailEnabled(!emailEnabled); if (emailEnabled) setForm({...form, email: ""}); }}
                style={{
                  display: "flex", alignItems: "center", gap: 10, cursor: "pointer",
                  padding: "12px 14px", borderRadius: 12,
                  background: emailEnabled ? "rgba(56,189,248,0.06)" : "transparent",
                  border: emailEnabled ? "1px solid rgba(56,189,248,0.2)" : "1px solid transparent",
                  transition: "all 0.2s",
                }}>
                <div style={{
                  width: 40, height: 22, borderRadius: 11, padding: 2, flexShrink: 0,
                  background: emailEnabled ? "#0ea5e9" : "#334155",
                  transition: "background 0.2s", display: "flex", alignItems: "center",
                }}>
                  <div style={{ width: 18, height: 18, borderRadius: "50%", background: "#fff",
                    transform: emailEnabled ? "translateX(18px)" : "translateX(0)", transition: "transform 0.2s" }} />
                </div>
                <div>
                  <div style={{ fontSize: 14, color: "#e2e8f0", fontWeight: 600 }}>ğŸ“© ë§ˆê° ì•Œë¦¼ ë°›ê¸°</div>
                  <div style={{ fontSize: 12, color: "#64748b", marginTop: 2 }}>ëª¨ë“  ì°¸ì—¬ìê°€ íˆ¬í‘œí•˜ë©´ ì´ë©”ì¼ë¡œ ì•Œë ¤ë“œë ¤ìš”</div>
                </div>
              </div>
              {emailEnabled && (
                <div style={{ marginTop: 10, paddingLeft: 4 }}>
                  <input type="email" value={form.email} onChange={e => setForm({...form, email: e.target.value})}
                    placeholder="example@gmail.com" style={{...inputStyle, borderColor: form.email && !form.email.includes("@") ? "#f87171" : "#334155"}} />
                  <div style={{ fontSize: 12, color: "#64748b", marginTop: 6 }}>ì „ì› íˆ¬í‘œ ì™„ë£Œ ì‹œ ê²°ê³¼ ìš”ì•½ì´ ë°œì†¡ë©ë‹ˆë‹¤</div>
                </div>
              )}
            </div>
          </div>
        </Card>
      );
    }

    // â”€â”€ ë¯¸ë‹ˆ ìº˜ë¦°ë” (êµ¬ê°„ ì„ íƒìš©) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function MiniMonthCalendar({ year, month, today, maxDate, focusRanges, focusStep, onDateClick }) {
      const WEEKDAYS = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
      const daysInMonth = getDaysInMonth(year, month);
      const firstDay = getFirstDayOfMonth(year, month);
      const monthNames = ["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"];
      const ranges = focusRanges || [];

      const cells = [];
      for (let i = 0; i < firstDay; i++) cells.push(<div key={`e-${i}`} />);
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dateStr = fmtDate(date);
        const isInRange = date >= today && date <= maxDate;
        const weekend = isWeekend(year, month, day);
        const holiday = getHolidayName(dateStr);
        const off = weekend || !!holiday;
        const isInFocus = ranges.some(r => dateStr >= r.s && dateStr <= r.e);
        const isEndpoint = ranges.some(r => dateStr === r.s || dateStr === r.e);

        cells.push(
          <div key={day} onClick={() => isInRange && !off && onDateClick(dateStr)} style={{
            aspectRatio: "1", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center",
            borderRadius: 8, cursor: isInRange && !off ? "pointer" : "default",
            opacity: isInRange ? (off ? 0.35 : 1) : 0.2,
            background: isEndpoint ? "#38bdf8" : (isInFocus && !off) ? "rgba(56,189,248,0.2)" : "transparent",
            fontSize: 13, fontWeight: isEndpoint ? 700 : 400,
            color: isEndpoint ? "#0f172a" : (holiday || date.getDay()===0) ? "#f87171" : date.getDay()===6 ? "#60a5fa" : "#cbd5e1",
          }}>
            {day}
            {holiday && !isEndpoint && <span style={{ fontSize: 6, color: "#f87171", lineHeight: 1, marginTop: 1 }}>{holiday.length > 2 ? holiday.slice(0,2) : holiday}</span>}
          </div>
        );
      }

      return (
        <div style={{ marginBottom: 12, background: "rgba(15,23,42,0.4)", borderRadius: 12, padding: 12 }}>
          <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 8, color: "#94a3b8" }}>{year}ë…„ {monthNames[month]}</div>
          <div style={{ display: "grid", gridTemplateColumns: "repeat(7,1fr)", gap: 2, marginBottom: 4 }}>
            {WEEKDAYS.map((d,i) => <div key={d} style={{ textAlign: "center", fontSize: 11, color: i===0?"#f87171":i===6?"#60a5fa":"#475569", padding: "2px 0" }}>{d}</div>)}
          </div>
          <div style={{ display: "grid", gridTemplateColumns: "repeat(7,1fr)", gap: 2 }}>{cells}</div>
        </div>
      );
    }

    // â”€â”€ ìƒì„± ì™„ë£Œ í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function CreatedScreen({ link }) {
      const [copied, setCopied] = useState(false);
      const handleCopy = () => { navigator.clipboard.writeText(link).then(() => { setCopied(true); setTimeout(() => setCopied(false), 2000); }); };
      return (
        <Card>
          <div style={{ textAlign: "center" }}>
            <div style={{ fontSize: 48, marginBottom: 12 }}>ğŸ‰</div>
            <div style={{ fontSize: 18, fontWeight: 700, marginBottom: 12 }}>ì•½ì†ì´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤!</div>
            <div style={{ padding: "12px 16px", borderRadius: 10, background: "rgba(56,189,248,0.15)", border: "1px solid rgba(56,189,248,0.3)", marginBottom: 20 }}>
              <span style={{ fontSize: 15, color: "#38bdf8", fontWeight: 700 }}>ğŸ‘‡ ì•„ë˜ ë§í¬ë¥¼ ì°¸ì—¬ìë“¤ì—ê²Œ ê³µìœ í•˜ì„¸ìš”</span>
            </div>
          </div>
          <div style={{ background: "#0f172a", borderRadius: 10, padding: "12px 14px", fontSize: 13, color: "#38bdf8", wordBreak: "break-all", marginBottom: 16, border: "1px solid #1e3a5f" }}>{link}</div>
          <Button onClick={handleCopy}>{copied ? "âœ“ ë³µì‚¬ë¨!" : "ë§í¬ ë³µì‚¬í•˜ê¸°"}</Button>
          <div style={{ marginTop: 12 }}><Button variant="secondary" onClick={() => window.location.href = link}>íˆ¬í‘œí•˜ëŸ¬ ê°€ê¸° â†’</Button></div>
        </Card>
      );
    }

    // â”€â”€ ì´ë¦„ ì„ íƒ í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function SelectNameScreen({ group, onSelect }) {
      const mealLabel = group.mealType === "lunch" ? "ì ì‹¬" : "ì €ë…";
      const mealEmoji = group.mealType === "lunch" ? "â˜€ï¸" : "ğŸŒ™";
      const title = group.groupName || `${mealLabel} ì•½ì† ì¡ì`;
      return (
        <Card>
          <div style={{ textAlign: "center", marginBottom: 24 }}>
            <div style={{ fontSize: 22, marginBottom: 8 }}>{mealEmoji}</div>
            <div style={{ fontSize: 18, fontWeight: 700, marginBottom: 6 }}>{title}</div>
            {group.groupName && <div style={{ fontSize: 13, color: "#64748b", marginBottom: 4 }}>{mealLabel} ì•½ì†</div>}
            <div style={{ fontSize: 14, color: "#94a3b8" }}>ë³¸ì¸ì˜ ì´ë¦„ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
          </div>
          <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
            {group.members.map(name => (
              <button key={name} onClick={() => onSelect(name)} style={{
                padding: "16px 20px", borderRadius: 12, border: "1px solid #334155",
                background: "rgba(15,23,42,0.6)", color: "#e2e8f0", fontSize: 16,
                fontWeight: 600, cursor: "pointer", transition: "all 0.2s",
                textAlign: "left", fontFamily: "inherit", display: "flex", alignItems: "center", gap: 12,
              }}
              onMouseOver={e => { e.currentTarget.style.borderColor="#38bdf8"; e.currentTarget.style.background="rgba(56,189,248,0.08)"; }}
              onMouseOut={e => { e.currentTarget.style.borderColor="#334155"; e.currentTarget.style.background="rgba(15,23,42,0.6)"; }}>
                <div style={{ width: 36, height: 36, borderRadius: "50%", background: "linear-gradient(135deg,#0ea5e9,#6366f1)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 14, fontWeight: 700, color: "#fff", flexShrink: 0 }}>{name[0]}</div>
                {name}
              </button>
            ))}
          </div>
        </Card>
      );
    }

    // â”€â”€ ì›”ë³„ ìº˜ë¦°ë” (íˆ¬í‘œìš©) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function MonthCalendar({ year, month, startDate, endDate, focusRanges, votes, onDayClick, blockedDates, dragState, onDragStart, onDragMove, onDragEnd, hideHeader }) {
      const WEEKDAYS = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
      const daysInMonth = getDaysInMonth(year, month);
      const firstDay = getFirstDayOfMonth(year, month);
      const monthNames = ["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"];
      const today = new Date(); today.setHours(0,0,0,0);
      const ranges = focusRanges || [];
      const blocked = blockedDates || new Set();

      // ë“œë˜ê·¸ ë²”ìœ„ ë‚´ì¸ì§€ í™•ì¸
      const isInDragRange = (dateStr) => {
        if (!dragState || !dragState.start) return false;
        const s = dragState.start < dragState.end ? dragState.start : dragState.end;
        const e = dragState.start < dragState.end ? dragState.end : dragState.start;
        return dateStr >= s && dateStr <= e;
      };

      const cells = [];
      for (let i = 0; i < firstDay; i++) cells.push(<div key={`e-${i}`} />);
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const dateStr = fmtDate(date);
        const isInRange = date >= startDate && date <= endDate && date >= today;
        const weekend = isWeekend(year, month, day);
        const holiday = getHolidayName(dateStr);
        const off = weekend || !!holiday;
        const isBlocked = blocked.has(dateStr);
        const vote = votes[dateStr];
        const vc = vote ? VOTE_COLORS[vote] : null;
        const isToday = fmtDate(date) === fmtDate(today);
        const isFocus = ranges.some(r => dateStr >= r.s && dateStr <= r.e);
        const canClick = isInRange && !off && !isBlocked;
        const inDrag = isInDragRange(dateStr) && canClick;

        cells.push(
          <div key={day}
            data-date={dateStr}
            data-canclick={canClick ? "1" : "0"}
            onMouseDown={() => canClick && onDragStart && onDragStart(dateStr)}
            onMouseEnter={() => dragState && dragState.start && canClick && onDragMove && onDragMove(dateStr)}
            onTouchStart={(e) => { if (canClick && onDragStart) { e.preventDefault(); onDragStart(dateStr); } }}
            onClick={() => !dragState?.start && canClick && onDayClick(dateStr)}
            style={{
              aspectRatio: "1", display: "flex", flexDirection: "column",
              alignItems: "center", justifyContent: "center", borderRadius: 10,
              cursor: canClick ? "pointer" : "default",
              opacity: isInRange ? (off || isBlocked ? 0.35 : 1) : 0.2,
              background: inDrag ? "rgba(129,140,248,0.4)"
                : isBlocked && !off ? "rgba(239,68,68,0.08)"
                : vc ? vc.bg
                : off && isFocus ? "repeating-linear-gradient(135deg, rgba(56,189,248,0.08), rgba(56,189,248,0.08) 3px, rgba(30,41,59,0.4) 3px, rgba(30,41,59,0.4) 6px)"
                : isFocus ? "rgba(56,189,248,0.1)"
                : "transparent",
              border: inDrag ? "2px solid #818cf8" : isToday ? "2px solid #38bdf8" : isFocus && !vc ? "1px solid rgba(56,189,248,0.25)" : isBlocked && !off ? "1px solid rgba(239,68,68,0.2)" : "1px solid transparent",
              transition: "all 0.1s", userSelect: "none",
              position: "relative",
            }}>
            <span style={{
              fontSize: 14, fontWeight: isToday ? 800 : 500,
              color: inDrag ? "#fff" : isBlocked && !off ? "#64748b" : vc ? vc.text : (holiday || date.getDay()===0) ? "#f87171" : date.getDay()===6 ? "#60a5fa" : "#cbd5e1",
              textDecoration: isBlocked && !off ? "line-through" : "none",
            }}>{day}</span>
            {isBlocked && !off && !vc && !inDrag && <span style={{ fontSize: 9, color: "#64748b", marginTop: 1 }}>âœ•</span>}
            {vc && !inDrag && <span style={{ fontSize: 9, color: vc.text, marginTop: 1, opacity: 0.9 }}>{vc.emoji}</span>}
            {holiday && !vc && !isBlocked && !inDrag && <span style={{ fontSize: 7, color: "#f87171", marginTop: 1, lineHeight: 1, textAlign: "center" }}>{holiday.length > 3 ? holiday.slice(0,3) : holiday}</span>}
          </div>
        );
      }

      // hideHeaderë©´ Card ì—†ì´ ë‚´ìš©ë§Œ ë°˜í™˜
      if (hideHeader) {
        return (
          <>
            <div style={{ display: "grid", gridTemplateColumns: "repeat(7,1fr)", gap: 4, marginBottom: 6 }}>
              {WEEKDAYS.map((d,i) => <div key={d} style={{ textAlign: "center", fontSize: 12, fontWeight: 600, color: i===0?"#f87171":i===6?"#60a5fa":"#64748b", padding: "4px 0" }}>{d}</div>)}
            </div>
            <div style={{ display: "grid", gridTemplateColumns: "repeat(7,1fr)", gap: 4 }}>{cells}</div>
          </>
        );
      }

      return (
        <Card>
          <div style={{ fontSize: 16, fontWeight: 700, marginBottom: 14, color: "#f1f5f9" }}>
            {year}ë…„ {monthNames[month]}
          </div>
          <div style={{ display: "grid", gridTemplateColumns: "repeat(7,1fr)", gap: 4, marginBottom: 6 }}>
            {WEEKDAYS.map((d,i) => <div key={d} style={{ textAlign: "center", fontSize: 12, fontWeight: 600, color: i===0?"#f87171":i===6?"#60a5fa":"#64748b", padding: "4px 0" }}>{d}</div>)}
          </div>
          <div style={{ display: "grid", gridTemplateColumns: "repeat(7,1fr)", gap: 4 }}>{cells}</div>
        </Card>
      );
    }

    // â”€â”€ ë“œë˜ê·¸ ì„ íƒ íŒì—… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function DragSelectPopup({ dates, onSelect, onCancel }) {
      const count = dates.length;
      const first = parseDate(dates[0]);
      const last = parseDate(dates[dates.length - 1]);
      const label = count === 1 
        ? fmtDisplay(first)
        : `${fmtDisplay(first)} ~ ${fmtDisplay(last)} (${count}ì¼)`;

      return (
        <div style={{
          position: "fixed", bottom: 0, left: 0, right: 0,
          background: "linear-gradient(to top, rgba(15,23,42,0.98) 0%, rgba(15,23,42,0.95) 100%)",
          borderTop: "1px solid rgba(56,189,248,0.3)",
          padding: "20px 16px 32px", zIndex: 1000,
          animation: "fadeIn 0.2s ease-out",
        }}>
          <div style={{ maxWidth: 480, margin: "0 auto" }}>
            <div style={{ textAlign: "center", marginBottom: 16 }}>
              <div style={{ fontSize: 15, fontWeight: 700, color: "#e2e8f0", marginBottom: 4 }}>
                {label}
              </div>
              <div style={{ fontSize: 13, color: "#64748b" }}>ì„ íƒí•œ ë‚ ì§œë¥¼ ì–´ë–»ê²Œ í‘œì‹œí• ê¹Œìš”?</div>
            </div>
            <div style={{ display: "flex", gap: 10 }}>
              <button onClick={() => onSelect("preferred")} style={{
                flex: 1, padding: "14px", borderRadius: 12,
                background: "#22c55e", border: "none",
                color: "#fff", fontSize: 15, fontWeight: 700, cursor: "pointer", fontFamily: "inherit",
              }}>
                â™¥ ì„ í˜¸
              </button>
              <button onClick={() => onSelect("unavailable")} style={{
                flex: 1, padding: "14px", borderRadius: 12,
                background: "#ef4444", border: "none",
                color: "#fff", fontSize: 15, fontWeight: 700, cursor: "pointer", fontFamily: "inherit",
              }}>
                âœ• ë¶ˆê°€
              </button>
              <button onClick={onCancel} style={{
                padding: "14px 20px", borderRadius: 12,
                background: "rgba(51,65,85,0.8)", border: "1px solid #475569",
                color: "#94a3b8", fontSize: 15, fontWeight: 600, cursor: "pointer", fontFamily: "inherit",
              }}>
                ì·¨ì†Œ
              </button>
            </div>
          </div>
        </div>
      );
    }

    // â”€â”€ ìº˜ë¦°ë” íˆ¬í‘œ í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function CalendarScreen({ group, userName, votes, setVotes, onSave, saving, loading, onManage, isCreator, onBack, onUpdateFocus }) {
      const [linkCopied, setLinkCopied] = useState(false);
      const [saveMsg, setSaveMsg] = useState("");
      const [editingFocus, setEditingFocus] = useState(false);
      const [focusStep, setFocusStep] = useState(0);
      const [tempStart, setTempStart] = useState("");
      const [newRanges, setNewRanges] = useState([]);
      const [focusSaving, setFocusSaving] = useState(false);
      
      // ë“œë˜ê·¸ ì„ íƒ ìƒíƒœ
      const [dragState, setDragState] = useState(null); // { start: dateStr, end: dateStr }
      const [pendingDates, setPendingDates] = useState(null); // íŒì—…ìš© ì„ íƒëœ ë‚ ì§œë“¤
      
      // ì•„ì½”ë””ì–¸ í¼ì¹¨ ìƒíƒœ
      const [expandedMonths, setExpandedMonths] = useState(new Set());

      const today = new Date(); today.setHours(0,0,0,0);
      const startDate = parseDate(group.dateStart);
      
      // ë§ˆì§€ë§‰ ë‚ ì§œ: ì˜¤ëŠ˜+90ì¼ì´ ì†í•œ ë‹¬ì˜ ë§ˆì§€ë§‰ ë‚ 
      const day90 = new Date(today);
      day90.setDate(day90.getDate() + 90);
      const endDate = new Date(day90.getFullYear(), day90.getMonth() + 1, 0); // í•´ë‹¹ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ 

      const focusRanges = group.focusRanges || [];
      const hasFocus = focusRanges.length > 0;

      // blockedDates ê³„ì‚°: ì²« í•µì‹¬êµ¬ê°„ ì´ì „ + êµ¬ê°„ ì‚¬ì´ (ë§ˆì§€ë§‰ êµ¬ê°„ ì´í›„ëŠ” ì—´ë¦¼)
      const blockedDates = React.useMemo(() => {
        const blocked = new Set();
        if (!hasFocus) return blocked;

        // êµ¬ê°„ ì •ë ¬
        const sorted = [...focusRanges].sort((a, b) => a.s.localeCompare(b.s));
        const firstStart = sorted[0].s;
        const lastEnd = sorted[sorted.length - 1].e;

        // ì „ì²´ ë‚ ì§œ ë²”ìœ„ ìˆœíšŒ
        const d = new Date(startDate);
        while (d <= endDate) {
          const ds = fmtDate(d);
          const inAnyFocus = sorted.some(r => ds >= r.s && ds <= r.e);

          if (ds < firstStart) {
            // ì²« í•µì‹¬êµ¬ê°„ ì´ì „ â†’ ì°¨ë‹¨
            blocked.add(ds);
          } else if (ds > lastEnd) {
            // ë§ˆì§€ë§‰ í•µì‹¬êµ¬ê°„ ì´í›„ â†’ ì—´ë¦¼ (ì°¨ë‹¨ ì•ˆ í•¨)
          } else if (!inAnyFocus) {
            // êµ¬ê°„ ì‚¬ì´ (ì–´ëŠ êµ¬ê°„ì—ë„ ì•ˆ ì†í•¨) â†’ ì°¨ë‹¨
            blocked.add(ds);
          }
          d.setDate(d.getDate() + 1);
        }
        return blocked;
      }, [focusRanges, hasFocus, startDate, endDate]);

      // ì›” ëª©ë¡ ê³„ì‚°: ì „ì²´ ê¸°ê°„ì˜ ëª¨ë“  ì›”
      const allMonths = React.useMemo(() => {
        const months = [];
        const cur = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
        while (cur <= endDate) {
          months.push({ year: cur.getFullYear(), month: cur.getMonth() });
          cur.setMonth(cur.getMonth() + 1);
        }
        return months;
      }, [startDate, endDate]);

      // ì›”ì´ ì™„ì „íˆ ì°¨ë‹¨ëëŠ”ì§€ í™•ì¸ (ëª¨ë“  í‰ì¼ì´ blockedë©´ ìˆ¨ê¹€)
      const isMonthFullyBlocked = React.useCallback((year, month) => {
        if (!hasFocus) return false;
        const daysInMonth = getDaysInMonth(year, month);
        for (let day = 1; day <= daysInMonth; day++) {
          const d = new Date(year, month, day);
          const ds = fmtDate(d);
          if (d < today) continue; // ê³¼ê±°ëŠ” ì–´ì°¨í”¼ ì„ íƒ ë¶ˆê°€
          if (d > endDate) continue;
          if (isOff(year, month, day)) continue; // ì£¼ë§/ê³µíœ´ì¼ ì œì™¸
          if (!blockedDates.has(ds)) return false; // ì„ íƒ ê°€ëŠ¥í•œ ë‚ ì´ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ false
        }
        return true;
      }, [hasFocus, blockedDates, today, endDate]);

      // ì›”ë³„ ìƒíƒœ ê³„ì‚°: íˆ¬í‘œ ê°€ëŠ¥í•œ ë‚ ì´ ìˆëŠ”ì§€
      const monthStatus = React.useMemo(() => {
        const status = {};
        allMonths.forEach(({year, month}) => {
          const key = `${year}-${month}`;
          const daysInMonth = getDaysInMonth(year, month);
          let hasVotableDays = false;
          for (let day = 1; day <= daysInMonth; day++) {
            const d = new Date(year, month, day);
            const ds = fmtDate(d);
            if (d < today) continue;
            if (d > endDate) continue;
            if (isOff(year, month, day)) continue;
            if (!blockedDates.has(ds)) {
              hasVotableDays = true;
              break;
            }
          }
          status[key] = { hasVotableDays, fullyBlocked: isMonthFullyBlocked(year, month) };
        });
        return status;
      }, [allMonths, blockedDates, today, endDate, isMonthFullyBlocked]);

      // ì•„ì½”ë””ì–¸ ì´ˆê¸°í™”: íˆ¬í‘œ ê°€ëŠ¥í•œ ë‚ ì´ ìˆëŠ” ì²« ë²ˆì§¸ ì›”ë§Œ í¼ì¹¨
      React.useEffect(() => {
        const firstVotableMonth = allMonths.find(({year, month}) => {
          const key = `${year}-${month}`;
          return monthStatus[key]?.hasVotableDays;
        });
        if (firstVotableMonth) {
          setExpandedMonths(new Set([`${firstVotableMonth.year}-${firstVotableMonth.month}`]));
        }
      }, []);

      const toggleMonth = (year, month) => {
        const key = `${year}-${month}`;
        setExpandedMonths(prev => {
          const next = new Set(prev);
          if (next.has(key)) next.delete(key);
          else next.add(key);
          return next;
        });
      };

      // í‘œì‹œí•  ì›” ëª©ë¡ (ì´ì œ ì „ë¶€ í‘œì‹œ, ì•„ì½”ë””ì–¸ìœ¼ë¡œ ê´€ë¦¬)
      const visibleMonths = allMonths;

      const handleDayClick = (dateStr) => {
        setVotes(prev => {
          const cur = prev[dateStr] || null;
          const idx = VOTE_CYCLE.indexOf(cur);
          const next = VOTE_CYCLE[(idx+1) % VOTE_CYCLE.length];
          if (next === null) { const nv = {...prev}; delete nv[dateStr]; return nv; }
          return {...prev, [dateStr]: next};
        });
      };

      // ë“œë˜ê·¸ í•¸ë“¤ëŸ¬
      const handleDragStart = (dateStr) => {
        setDragState({ start: dateStr, end: dateStr });
      };

      const handleDragMove = (dateStr) => {
        if (dragState) {
          setDragState({ ...dragState, end: dateStr });
        }
      };

      const handleDragEnd = () => {
        if (dragState && dragState.start) {
          // ì„ íƒëœ ë²”ìœ„ì˜ ë‚ ì§œë“¤ ê³„ì‚° (ì„ íƒ ê°€ëŠ¥í•œ ë‚ ë§Œ)
          const s = dragState.start < dragState.end ? dragState.start : dragState.end;
          const e = dragState.start < dragState.end ? dragState.end : dragState.start;
          const dates = [];
          const d = parseDate(s);
          const ed = parseDate(e);
          while (d <= ed) {
            const ds = fmtDate(d);
            const y = d.getFullYear(), m = d.getMonth(), day = d.getDate();
            if (d >= today && !isOff(y,m,day) && !blockedDates.has(ds)) {
              dates.push(ds);
            }
            d.setDate(d.getDate() + 1);
          }
          
          if (dates.length === 1) {
            // ë‹¨ì¼ ì„ íƒ: ê¸°ì¡´ì²˜ëŸ¼ ë°”ë¡œ í† ê¸€
            handleDayClick(dates[0]);
          } else if (dates.length > 1) {
            // ë“œë˜ê·¸ ì„ íƒ (2ê°œ ì´ìƒ): íŒì—… í‘œì‹œ
            setPendingDates(dates);
          }
          setDragState(null);
        }
      };

      const handleDragSelect = (voteType) => {
        if (pendingDates && pendingDates.length > 0) {
          setVotes(prev => {
            const newVotes = { ...prev };
            pendingDates.forEach(ds => {
              newVotes[ds] = voteType;
            });
            return newVotes;
          });
        }
        setPendingDates(null);
      };

      const handleDragCancel = () => {
        // ì·¨ì†Œ ì‹œ ì„ íƒëœ ë‚ ì§œë“¤ì„ ë¹ˆ ìƒíƒœ(ë¹„ì„ í˜¸)ë¡œ ë˜ëŒë¦¼
        if (pendingDates && pendingDates.length > 0) {
          setVotes(prev => {
            const newVotes = { ...prev };
            pendingDates.forEach(ds => {
              delete newVotes[ds];
            });
            return newVotes;
          });
        }
        setPendingDates(null);
      };

      // ë§ˆìš°ìŠ¤ up ì´ë²¤íŠ¸ ì „ì—­ ë“±ë¡
      React.useEffect(() => {
        const handleMouseUp = () => {
          if (dragState) handleDragEnd();
        };
        const handleTouchEnd = (e) => {
          if (dragState) {
            // í„°ì¹˜ ìœ„ì¹˜ì˜ ìš”ì†Œ í™•ì¸
            const touch = e.changedTouches[0];
            const el = document.elementFromPoint(touch.clientX, touch.clientY);
            if (el && el.dataset.date && el.dataset.canclick === "1") {
              setDragState(prev => prev ? { ...prev, end: el.dataset.date } : null);
            }
            setTimeout(() => handleDragEnd(), 10);
          }
        };
        const handleTouchMove = (e) => {
          if (dragState) {
            const touch = e.touches[0];
            const el = document.elementFromPoint(touch.clientX, touch.clientY);
            if (el && el.dataset.date && el.dataset.canclick === "1") {
              setDragState(prev => prev ? { ...prev, end: el.dataset.date } : null);
            }
          }
        };
        window.addEventListener("mouseup", handleMouseUp);
        window.addEventListener("touchend", handleTouchEnd);
        window.addEventListener("touchmove", handleTouchMove, { passive: true });
        return () => {
          window.removeEventListener("mouseup", handleMouseUp);
          window.removeEventListener("touchend", handleTouchEnd);
          window.removeEventListener("touchmove", handleTouchMove);
        };
      }, [dragState]);

      const handleCopyLink = () => { navigator.clipboard.writeText(window.location.href).then(() => { setLinkCopied(true); setTimeout(() => setLinkCopied(false), 2000); }); };

      const handleSave = async () => {
        await onSave();
        setSaveMsg("ì €ì¥ ì™„ë£Œ âœ“");
        setTimeout(() => setSaveMsg(""), 2000);
      };

      const counts = Object.values(votes).reduce((a,v) => { a[v]=(a[v]||0)+1; return a; }, {});

      const mealLabel = group.mealType === "lunch" ? "ì ì‹¬" : "ì €ë…";
      const mealEmoji = group.mealType === "lunch" ? "â˜€ï¸" : "ğŸŒ™";
      const title = group.groupName || `${mealLabel} ì•½ì† ì¡ì`;

      // í•µì‹¬êµ¬ê°„ ìˆ˜ì • í•¸ë“¤ëŸ¬ (ë°œí–‰ììš©)
      const handleFocusDateClick = (dateStr) => {
        if (focusStep === 0) {
          setTempStart(dateStr);
          setFocusStep(1);
        } else {
          let s = tempStart, e = dateStr;
          if (e < s) { const t = s; s = e; e = t; }
          setNewRanges([...newRanges, { s, e }]);
          setTempStart("");
          setFocusStep(0);
        }
      };

      const handleFocusSave = async () => {
        if (newRanges.length === 0) return;
        setFocusSaving(true);
        try {
          await onUpdateFocus(newRanges);
          setEditingFocus(false);
          setNewRanges([]);
        } finally { setFocusSaving(false); }
      };

      return (
        <div>
          <Card style={{ padding: 16 }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
              <button onClick={onBack} style={{ background: "none", border: "none", color: "#94a3b8", fontSize: 14, cursor: "pointer", fontFamily: "inherit" }}>â† ë’¤ë¡œ</button>
              <div style={{ fontSize: 15, fontWeight: 700 }}>{mealEmoji} {title}</div>
              <button onClick={handleCopyLink} style={{ background: "none", border: "none", color: linkCopied ? "#22c55e" : "#64748b", fontSize: 13, cursor: "pointer", fontFamily: "inherit", whiteSpace: "nowrap" }}>
                {linkCopied ? "âœ“ ë³µì‚¬ë¨" : "ğŸ”— ë§í¬"}
              </button>
            </div>
            <div style={{ textAlign: "center", fontSize: 13, color: "#64748b", marginTop: 6 }}>
              <span style={{ color: "#38bdf8", fontWeight: 600 }}>{userName}</span>ë‹˜ì˜ íˆ¬í‘œ
            </div>
          </Card>

          {/* í•µì‹¬êµ¬ê°„ í‘œì‹œ + ë°œí–‰ì ìˆ˜ì • */}
          {hasFocus && (
            <Card style={{ padding: 16 }}>
              <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: editingFocus ? 12 : 0 }}>
                <div>
                  <div style={{ fontSize: 13, color: "#64748b", marginBottom: 4 }}>ğŸ“… í•µì‹¬ êµ¬ê°„</div>
                  <div style={{ fontSize: 14, color: "#38bdf8", fontWeight: 600 }}>
                    {focusRanges.map((r,i) => `${fmtDisplay(parseDate(r.s))}~${fmtDisplay(parseDate(r.e))}`).join(", ")}
                  </div>
                </div>
                {isCreator && !editingFocus && (
                  <button onClick={() => { setEditingFocus(true); setNewRanges([]); setFocusStep(0); setTempStart(""); }} style={{
                    padding: "6px 12px", borderRadius: 8, background: "rgba(56,189,248,0.1)",
                    border: "1px solid rgba(56,189,248,0.3)", color: "#38bdf8", fontSize: 12, cursor: "pointer", fontFamily: "inherit",
                  }}>ìˆ˜ì •</button>
                )}
              </div>

              {/* í•µì‹¬êµ¬ê°„ ìˆ˜ì • UI */}
              {editingFocus && (
                <div style={{ borderTop: "1px solid rgba(71,85,105,0.3)", paddingTop: 12 }}>
                  <div style={{ fontSize: 12, color: "#f59e0b", marginBottom: 10 }}>
                    {focusStep === 0 ? "ìƒˆ êµ¬ê°„ì˜ ì‹œì‘ì¼ì„ ì„ íƒí•˜ì„¸ìš”" : "ì¢…ë£Œì¼ì„ ì„ íƒí•˜ì„¸ìš”"}
                  </div>

                  {/* ìƒˆ êµ¬ê°„ ë¦¬ìŠ¤íŠ¸ */}
                  {newRanges.length > 0 && (
                    <div style={{ display: "flex", flexWrap: "wrap", gap: 6, marginBottom: 10 }}>
                      {newRanges.map((r, idx) => (
                        <div key={idx} style={{ display: "flex", alignItems: "center", gap: 4, padding: "4px 10px", borderRadius: 6, background: "rgba(56,189,248,0.1)", border: "1px solid rgba(56,189,248,0.3)" }}>
                          <span style={{ fontSize: 12, color: "#38bdf8" }}>{fmtDisplay(parseDate(r.s))}~{fmtDisplay(parseDate(r.e))}</span>
                          <button onClick={() => setNewRanges(newRanges.filter((_,i) => i !== idx))} style={{ background: "none", border: "none", color: "#64748b", fontSize: 12, cursor: "pointer", padding: 0, marginLeft: 2 }}>âœ•</button>
                        </div>
                      ))}
                    </div>
                  )}

                  {/* ë²„íŠ¼ì„ ë‹¬ë ¥ ìœ„ì— ë°°ì¹˜ */}
                  <div style={{ display: "flex", gap: 8, marginBottom: 12 }}>
                    <button onClick={() => { setEditingFocus(false); setNewRanges([]); }} style={{
                      flex: 1, padding: "10px", borderRadius: 8, background: "rgba(51,65,85,0.6)",
                      border: "1px solid #475569", color: "#94a3b8", fontSize: 13, cursor: "pointer", fontFamily: "inherit",
                    }}>ì·¨ì†Œ</button>
                    <button onClick={handleFocusSave} disabled={newRanges.length === 0 || focusSaving} style={{
                      flex: 1, padding: "10px", borderRadius: 8,
                      background: newRanges.length > 0 ? "linear-gradient(135deg,#0ea5e9,#38bdf8)" : "rgba(51,65,85,0.6)",
                      border: "none", color: "#fff", fontSize: 13, cursor: newRanges.length > 0 ? "pointer" : "default",
                      opacity: newRanges.length === 0 ? 0.5 : 1, fontFamily: "inherit",
                    }}>{focusSaving ? "ì €ì¥ ì¤‘..." : "êµ¬ê°„ ë³€ê²½"}</button>
                  </div>

                  {/* ë¯¸ë‹ˆ ìº˜ë¦°ë” */}
                  {(() => {
                    const miniMonths = [];
                    const c = new Date(Math.max(today, startDate)); c.setDate(1);
                    while (c <= endDate) {
                      miniMonths.push({ year: c.getFullYear(), month: c.getMonth() });
                      c.setMonth(c.getMonth() + 1);
                    }
                    return miniMonths.map(({year, month}) => (
                      <MiniMonthCalendar key={`${year}-${month}`} year={year} month={month}
                        today={today} maxDate={endDate}
                        focusRanges={[...newRanges, ...(tempStart ? [{s: tempStart, e: tempStart}] : [])]}
                        focusStep={focusStep}
                        onDateClick={handleFocusDateClick} />
                    ));
                  })()}
                </div>
              )}
            </Card>
          )}

          {/* íˆ¬í‘œ ê°€ì´ë“œ â€” ëˆˆì— ë„ëŠ” ìŠ¤íƒ€ì¼ */}
          <Card style={{ padding: 20, background: "linear-gradient(135deg, rgba(56,189,248,0.12) 0%, rgba(129,140,248,0.08) 100%)", border: "1px solid rgba(56,189,248,0.3)" }}>
            {/* ë©”ì¸ ì§€ì¹¨ */}
            {hasFocus && (
              <div style={{ textAlign: "center", fontSize: 16, fontWeight: 800, color: "#38bdf8", marginBottom: 6, lineHeight: 1.5 }}>
                ğŸ“… í•˜ëŠ˜ìƒ‰ ì˜ì—­ ìœ„ì£¼ë¡œ íˆ¬í‘œí•´ì£¼ì„¸ìš”
              </div>
            )}
            {hasFocus && (
              <div style={{ textAlign: "center", fontSize: 12, color: "#94a3b8", marginBottom: 16 }}>
                í•µì‹¬ êµ¬ê°„ ì´ì „Â·ì‚¬ì´ëŠ” íˆ¬í‘œ ë¶ˆê°€ Â· êµ¬ê°„ ì´í›„ëŠ” íˆ¬í‘œ ê°€ëŠ¥
              </div>
            )}

            {/* íƒ­ ì¡°ì‘ë²• */}
            <div style={{ display: "flex", alignItems: "center", justifyContent: "center", gap: 8, marginBottom: 16, flexWrap: "wrap" }}>
              <span style={{ fontSize: 13, color: "#e2e8f0" }}>í•œ ë²ˆ íƒ­</span>
              <div style={{ width: 28, height: 28, borderRadius: 6, background: "#22c55e", display: "flex", alignItems: "center", justifyContent: "center" }}>
                <span style={{ fontSize: 11, color: "#fff", fontWeight: 700 }}>â™¥</span>
              </div>
              <span style={{ fontSize: 13, color: "#64748b", margin: "0 4px" }}>â†’</span>
              <span style={{ fontSize: 13, color: "#e2e8f0" }}>ë‘ ë²ˆ íƒ­</span>
              <div style={{ width: 28, height: 28, borderRadius: 6, background: "#ef4444", display: "flex", alignItems: "center", justifyContent: "center" }}>
                <span style={{ fontSize: 11, color: "#fff", fontWeight: 700 }}>âœ•</span>
              </div>
              <span style={{ fontSize: 13, color: "#64748b", margin: "0 4px" }}>â†’</span>
              <span style={{ fontSize: 13, color: "#e2e8f0" }}>ì„¸ ë²ˆ íƒ­ í•´ì œ</span>
            </div>

            {/* ë²”ë¡€ â€” í¬ê²Œ */}
            <div style={{ display: "flex", justifyContent: "center", gap: 24, marginBottom: 14 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                <div style={{ width: 20, height: 20, borderRadius: 6, background: "#22c55e" }} />
                <span style={{ fontSize: 15, fontWeight: 700, color: "#e2e8f0" }}>ì„ í˜¸í•˜ëŠ” ë‚ </span>
                <span style={{ fontSize: 14, color: "#94a3b8" }}>({counts["preferred"]||0})</span>
              </div>
              <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                <div style={{ width: 20, height: 20, borderRadius: 6, background: "#ef4444" }} />
                <span style={{ fontSize: 15, fontWeight: 700, color: "#e2e8f0" }}>ì ˆëŒ€ ì•ˆë˜ëŠ” ë‚ </span>
                <span style={{ fontSize: 14, color: "#94a3b8" }}>({counts["unavailable"]||0})</span>
              </div>
            </div>

            {/* ë¹ˆ ë‚ ì§œ ì„¤ëª… â€” ê°•ì¡° */}
            <div style={{ textAlign: "center", padding: "12px 16px", borderRadius: 10, background: "rgba(245,158,11,0.15)", border: "2px solid rgba(245,158,11,0.4)" }}>
              <span style={{ fontSize: 14, color: "#fbbf24", fontWeight: 700 }}>âš ï¸ ë¹ˆ ë‚ ì§œ = ê°€ëŠ¥í•˜ì§€ë§Œ ë¹„ì„ í˜¸</span>
              <div style={{ fontSize: 12, color: "#d97706", marginTop: 4 }}>ì„ í˜¸í•˜ëŠ” ë‚ ë§Œ ì´ˆë¡ìƒ‰ìœ¼ë¡œ í‘œì‹œí•´ì£¼ì„¸ìš”</div>
            </div>

            {/* ë‚˜ë¨¸ì§€ ì „ë¶€ ë¶ˆê°€ */}
            {Object.values(votes).some(v => v === "preferred") && (
              <button onClick={() => {
                setVotes(prev => {
                  const newVotes = {...prev};
                  const d = new Date(startDate);
                  while (d <= endDate) {
                    const ds = fmtDate(d);
                    const y = d.getFullYear(), m = d.getMonth(), day = d.getDate();
                    if (d >= today && !isOff(y,m,day) && !blockedDates.has(ds) && !newVotes[ds]) {
                      newVotes[ds] = "unavailable";
                    }
                    d.setDate(d.getDate()+1);
                  }
                  return newVotes;
                });
              }} style={{
                width: "100%", marginTop: 12, padding: "12px 14px", borderRadius: 10,
                background: "rgba(239,68,68,0.1)", border: "1px solid rgba(239,68,68,0.3)",
                color: "#f87171", fontSize: 14, fontWeight: 600, cursor: "pointer", fontFamily: "inherit",
                textAlign: "center",
              }}>
                ğŸƒ ë‚œ ë„ˆë¬´ ë°”ë¹  <span style={{ color: "#94a3b8", fontSize: 12, fontWeight: 400 }}>(ì„ í˜¸ ì™¸ ì „ë¶€ ë¶ˆê°€)</span>
              </button>
            )}
          </Card>

          {/* ìº˜ë¦°ë” â€” ì•„ì½”ë””ì–¸ ìŠ¤íƒ€ì¼ */}
          {visibleMonths.map(({year, month}) => {
            const key = `${year}-${month}`;
            const isExpanded = expandedMonths.has(key);
            const status = monthStatus[key] || {};
            const monthNames = ["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"];
            
            return (
              <Card key={key} style={{ padding: 0, overflow: "hidden" }}>
                {/* ì›” í—¤ë” (í´ë¦­ ê°€ëŠ¥) */}
                <div 
                  onClick={() => toggleMonth(year, month)}
                  style={{
                    display: "flex", alignItems: "center", justifyContent: "space-between",
                    padding: "14px 16px", cursor: "pointer",
                    background: isExpanded ? "transparent" : "rgba(15,23,42,0.4)",
                    borderBottom: isExpanded ? "1px solid rgba(71,85,105,0.3)" : "none",
                  }}
                >
                  <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                    <span style={{ fontSize: 16, fontWeight: 700, color: status.hasVotableDays ? "#e2e8f0" : "#64748b" }}>
                      {year}ë…„ {monthNames[month]}
                    </span>
                    {!status.hasVotableDays && (
                      <span style={{ fontSize: 11, color: "#64748b", background: "rgba(71,85,105,0.3)", padding: "2px 8px", borderRadius: 4 }}>
                        íˆ¬í‘œ ë¶ˆê°€
                      </span>
                    )}
                  </div>
                  <span style={{ fontSize: 14, color: "#64748b", transition: "transform 0.2s", transform: isExpanded ? "rotate(180deg)" : "rotate(0deg)" }}>
                    â–¼
                  </span>
                </div>
                
                {/* ìº˜ë¦°ë” ë³¸ë¬¸ (í¼ì³ì¡Œì„ ë•Œë§Œ) */}
                {isExpanded && (
                  <div style={{ padding: "12px 16px 16px" }}>
                    <MonthCalendar year={year} month={month}
                      startDate={startDate} endDate={endDate}
                      focusRanges={focusRanges}
                      votes={votes} onDayClick={handleDayClick}
                      blockedDates={blockedDates}
                      dragState={dragState}
                      onDragStart={handleDragStart}
                      onDragMove={handleDragMove}
                      onDragEnd={handleDragEnd}
                      hideHeader={true} />
                  </div>
                )}
              </Card>
            );
          })}

          {/* ë“œë˜ê·¸ ì„ íƒ íŒì—… */}
          {pendingDates && pendingDates.length > 0 && (
            <DragSelectPopup
              dates={pendingDates}
              onSelect={handleDragSelect}
              onCancel={handleDragCancel} />
          )}

          <div style={{ position: "sticky", bottom: 0, padding: "16px 0 24px", background: "linear-gradient(transparent, #0f172a 20%)" }}>
            <Button onClick={handleSave} disabled={saving}>
              {saving ? "ì €ì¥ ì¤‘..." : saveMsg || "íˆ¬í‘œ ì €ì¥í•˜ê¸°"}
            </Button>
            {isCreator && <div style={{ marginTop: 10 }}><Button variant="secondary" onClick={onManage}>íˆ¬í‘œ ê´€ë¦¬ (ë§ˆê°)</Button></div>}
          </div>
        </div>
      );
    }

    // â”€â”€ ê´€ë¦¬ í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function ManageScreen({ group, voteStatus, onClose, onBack, loading, onRefresh, onUpdateFocus }) {
      const [confirmClose, setConfirmClose] = useState(false);
      const [editingFocus, setEditingFocus] = useState(false);
      const [focusStep, setFocusStep] = useState(0);
      const [tempStart, setTempStart] = useState("");
      const [newRanges, setNewRanges] = useState(group.focusRanges || []);
      const [focusSaving, setFocusSaving] = useState(false);
      const [focusMsg, setFocusMsg] = useState("");
      const [vip, setVip] = useState("");

      if (!voteStatus) return <LoadingSpinner />;
      const notVoted = voteStatus.members.filter(m => !m.voted);
      const allVoted = notVoted.length === 0;

      const today = new Date(); today.setHours(0,0,0,0);
      const startDate = parseDate(group.dateStart);
      const endDate = parseDate(group.dateEnd);

      // ë¯¸ë‹ˆ ìº˜ë¦°ë” ì›” ëª©ë¡
      const months = [];
      const cur = new Date(Math.max(today, startDate));
      cur.setDate(1);
      while (cur <= endDate) {
        months.push({ year: cur.getFullYear(), month: cur.getMonth() });
        cur.setMonth(cur.getMonth() + 1);
      }

      const handleFocusDateClick = (dateStr) => {
        if (focusStep === 0) {
          setTempStart(dateStr);
          setFocusStep(1);
        } else {
          let s = tempStart, e = dateStr;
          if (e < s) { const t = s; s = e; e = t; }
          setNewRanges([...newRanges, { s, e }]);
          setTempStart("");
          setFocusStep(0);
        }
      };

      const handleFocusSave = async () => {
        if (newRanges.length === 0) return;
        setFocusSaving(true);
        try {
          await onUpdateFocus(newRanges);
          setFocusMsg("ë³€ê²½ ì™„ë£Œ âœ“");
          setEditingFocus(false);
          setTimeout(() => setFocusMsg(""), 3000);
        } finally { setFocusSaving(false); }
      };

      const currentFocusLabel = () => {
        const ranges = group.focusRanges || [];
        if (ranges.length === 0) return "ë¯¸ì„¤ì •";
        return ranges.map(r => `${fmtDisplay(parseDate(r.s))}~${fmtDisplay(parseDate(r.e))}`).join(", ");
      };

      return (
        <div>
          <Card style={{ padding: 16 }}>
            <button onClick={onBack} style={{ background: "none", border: "none", color: "#94a3b8", fontSize: 14, cursor: "pointer", fontFamily: "inherit" }}>â† ìº˜ë¦°ë”ë¡œ ëŒì•„ê°€ê¸°</button>
          </Card>

          {/* í•µì‹¬êµ¬ê°„ ë³€ê²½ */}
          <Card>
            <div style={{ fontSize: 16, fontWeight: 700, marginBottom: 14 }}>ğŸ“… í•µì‹¬ êµ¬ê°„</div>
            <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between", padding: "10px 14px", borderRadius: 10, background: "rgba(56,189,248,0.08)", border: "1px solid rgba(56,189,248,0.2)", marginBottom: 12 }}>
              <span style={{ fontSize: 14, color: "#38bdf8", fontWeight: 600 }}>{currentFocusLabel()}</span>
              {focusMsg && <span style={{ fontSize: 13, color: "#22c55e", fontWeight: 600 }}>{focusMsg}</span>}
            </div>
            {!editingFocus ? (
              <Button variant="secondary" onClick={() => { setEditingFocus(true); setFocusStep(0); setTempStart(""); setNewRanges([]); }}>êµ¬ê°„ ë³€ê²½í•˜ê¸°</Button>
            ) : (
              <div>
                {/* ìƒˆë¡œ ì¶”ê°€ëœ êµ¬ê°„ ë¦¬ìŠ¤íŠ¸ */}
                {newRanges.length > 0 && (
                  <div style={{ display: "flex", flexDirection: "column", gap: 6, marginBottom: 10 }}>
                    {newRanges.map((r, idx) => (
                      <div key={idx} style={{ display: "flex", alignItems: "center", gap: 8 }}>
                        <div style={{ flex: 1, padding: "8px 12px", borderRadius: 8, background: "rgba(56,189,248,0.1)", border: "1px solid rgba(56,189,248,0.3)", fontSize: 13, color: "#38bdf8", fontWeight: 600 }}>
                          {fmtDisplay(parseDate(r.s))} ~ {fmtDisplay(parseDate(r.e))}
                        </div>
                        <button onClick={() => setNewRanges(newRanges.filter((_,i) => i !== idx))} style={{ background: "none", border: "none", color: "#64748b", fontSize: 16, cursor: "pointer" }}>âœ•</button>
                      </div>
                    ))}
                  </div>
                )}

                <div style={{ fontSize: 13, color: "#38bdf8", marginBottom: 8, fontWeight: 600 }}>
                  {focusStep === 0 ? "â–¸ ì‹œì‘ì¼ì„ ì„ íƒí•˜ì„¸ìš”" : "â–¸ ì¢…ë£Œì¼ì„ ì„ íƒí•˜ì„¸ìš”"}
                </div>
                {tempStart && (
                  <div style={{ fontSize: 13, color: "#94a3b8", marginBottom: 8 }}>
                    ì„ íƒ: {fmtDisplay(parseDate(tempStart))} ~ ...
                  </div>
                )}
                {months.map(({year, month}) => (
                  <MiniMonthCalendar key={`mng-${year}-${month}`} year={year} month={month}
                    today={today} maxDate={endDate}
                    focusRanges={[...newRanges, ...(tempStart ? [{s: tempStart, e: tempStart}] : [])]}
                    focusStep={focusStep}
                    onDateClick={handleFocusDateClick} />
                ))}
                <div style={{ display: "flex", gap: 10, marginTop: 8 }}>
                  <Button variant="secondary" onClick={() => setEditingFocus(false)} style={{ flex: 1 }}>ì·¨ì†Œ</Button>
                  <Button onClick={handleFocusSave} disabled={newRanges.length === 0 || focusSaving} style={{ flex: 1 }}>
                    {focusSaving ? "ì €ì¥ ì¤‘..." : "êµ¬ê°„ ë³€ê²½ ì €ì¥"}
                  </Button>
                </div>
              </div>
            )}
          </Card>

          {/* íˆ¬í‘œ í˜„í™© */}
          <Card>
            <div style={{ fontSize: 16, fontWeight: 700, marginBottom: 20 }}>íˆ¬í‘œ í˜„í™©</div>
            <div style={{ display: "flex", flexDirection: "column", gap: 10, marginBottom: 20 }}>
              {voteStatus.members.map(m => (
                <div key={m.name} style={{
                  display: "flex", justifyContent: "space-between", alignItems: "center",
                  padding: "12px 16px", borderRadius: 10,
                  background: m.voted ? "rgba(34,197,94,0.1)" : "rgba(239,68,68,0.1)",
                  border: `1px solid ${m.voted ? "rgba(34,197,94,0.2)" : "rgba(239,68,68,0.2)"}`,
                }}>
                  <span style={{ fontWeight: 600 }}>{m.name}</span>
                  <span style={{ fontSize: 13, color: m.voted ? "#22c55e" : "#ef4444", fontWeight: 600 }}>{m.voted ? "íˆ¬í‘œ ì™„ë£Œ âœ“" : "ë¯¸íˆ¬í‘œ"}</span>
                </div>
              ))}
            </div>
            <div style={{ fontSize: 13, color: "#64748b", textAlign: "center", marginBottom: 16 }}>{voteStatus.votedCount}/{voteStatus.totalMembers}ëª… íˆ¬í‘œ ì™„ë£Œ</div>
            <Button variant="secondary" onClick={onRefresh} style={{ marginBottom: 12 }}>ìƒˆë¡œê³ ì¹¨</Button>

            {/* ì£¼ì¸ê³µ ëª¨ë“œ */}
            <div style={{ padding: "14px 16px", borderRadius: 12, background: "rgba(168,85,247,0.06)", border: "1px solid rgba(168,85,247,0.2)", marginBottom: 12 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 10 }}>
                <span style={{ fontSize: 18 }}>ğŸ‘‘</span>
                <span style={{ fontSize: 14, fontWeight: 700, color: "#c084fc" }}>ì£¼ì¸ê³µ ëª¨ë“œ</span>
                <span style={{ fontSize: 12, color: "#64748b" }}>ì„ íƒì‚¬í•­</span>
              </div>
              <div style={{ fontSize: 12, color: "#94a3b8", marginBottom: 10 }}>íŠ¹ì • í•œ ì‚¬ëŒì´ ë˜ëŠ” ë‚  ì¤‘ì—ì„œë§Œ ìµœì  ë‚ ì§œë¥¼ ì°¾ìŠµë‹ˆë‹¤</div>
              <div style={{ display: "flex", flexWrap: "wrap", gap: 8 }}>
                <button onClick={() => setVip("")} style={{
                  padding: "8px 14px", borderRadius: 8, fontSize: 13, fontFamily: "inherit", cursor: "pointer",
                  border: !vip ? "2px solid #c084fc" : "1px solid #334155",
                  background: !vip ? "rgba(168,85,247,0.15)" : "transparent",
                  color: !vip ? "#e2e8f0" : "#64748b", fontWeight: !vip ? 700 : 400,
                }}>ì—†ìŒ</button>
                {group.members.filter(m => !group.excluded || !group.excluded.includes(m)).map(name => (
                  <button key={name} onClick={() => setVip(name)} style={{
                    padding: "8px 14px", borderRadius: 8, fontSize: 13, fontFamily: "inherit", cursor: "pointer",
                    border: vip === name ? "2px solid #c084fc" : "1px solid #334155",
                    background: vip === name ? "rgba(168,85,247,0.15)" : "transparent",
                    color: vip === name ? "#e2e8f0" : "#94a3b8", fontWeight: vip === name ? 700 : 400,
                  }}>
                    {vip === name && "ğŸ‘‘ "}{name}
                  </button>
                ))}
              </div>
            </div>

            {!confirmClose ? (
              <Button variant={allVoted ? "primary" : "danger"} onClick={() => setConfirmClose(true)}>
                {allVoted ? "íˆ¬í‘œ ë§ˆê°í•˜ê¸°" : "íˆ¬í‘œ ë§ˆê°í•˜ê¸° (ë¯¸íˆ¬í‘œì ìˆìŒ)"}
              </Button>
            ) : (
              <Card style={{ background: "rgba(239,68,68,0.08)", border: "1px solid rgba(239,68,68,0.3)" }}>
                {notVoted.length > 0 ? (
                  <div style={{ marginBottom: 16 }}>
                    <div style={{ fontSize: 15, fontWeight: 700, color: "#f87171", marginBottom: 8 }}>ë¯¸íˆ¬í‘œìë¥¼ ì œì™¸í•˜ê³  ë§ˆê°í• ê¹Œìš”?</div>
                    <div style={{ fontSize: 14, color: "#94a3b8" }}>ì œì™¸ ëŒ€ìƒ: {notVoted.map(m => m.name).join(", ")}</div>
                  </div>
                ) : (
                  <div style={{ marginBottom: 16 }}>
                    <div style={{ fontSize: 15, fontWeight: 700, marginBottom: 8 }}>íˆ¬í‘œë¥¼ ë§ˆê°í• ê¹Œìš”?</div>
                    <div style={{ fontSize: 14, color: "#94a3b8" }}>ë§ˆê° í›„ì—ëŠ” ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
                  </div>
                )}
                <div style={{ display: "flex", gap: 10 }}>
                  <Button variant="secondary" onClick={() => setConfirmClose(false)} style={{ flex: 1 }}>ì·¨ì†Œ</Button>
                  <Button variant="danger" onClick={() => onClose(notVoted.map(m => m.name), vip)} disabled={loading} style={{ flex: 1 }}>{loading ? "ì²˜ë¦¬ ì¤‘..." : "ë§ˆê° í™•ì¸"}</Button>
                </div>
              </Card>
            )}
          </Card>
        </div>
      );
    }

    // â”€â”€ ê²°ê³¼ í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function ResultScreen({ result, group, onConfirmDate }) {
      const confirmedDate = group && group.confirmedDate;
      const [selectedDate, setSelectedDate] = useState(confirmedDate || null);
      const [eventTitle, setEventTitle] = useState(group && group.groupName ? group.groupName : "");
      const [eventTime, setEventTime] = useState(group && group.mealType === "lunch" ? "12:00" : "19:00");
      const [eventDuration, setEventDuration] = useState("2");
      const [gcalLink, setGcalLink] = useState("");
      const [linkCopied, setLinkCopied] = useState(false);
      const [confirming, setConfirming] = useState(false);
      const [capturing, setCapturing] = useState(false);
      const captureRef = React.useRef(null);

      if (!result || !result.success) return <Card><div style={{ textAlign: "center", padding: 24, color: "#94a3b8" }}>ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div></Card>;

      const mealLabel = group && group.mealType === "lunch" ? "ì ì‹¬" : "ì €ë…";
      const mealEmoji = group && group.mealType === "lunch" ? "â˜€ï¸" : "ğŸŒ™";
      const defaultTime = group && group.mealType === "lunch" ? "12:00" : "19:00";

      const cfg = {
        1: { icon: "ğŸ‰", color: "#22c55e", bg: "rgba(34,197,94,0.08)", border: "rgba(34,197,94,0.3)" },
        2: { icon: "ğŸ“…", color: "#f59e0b", bg: "rgba(245,158,11,0.08)", border: "rgba(245,158,11,0.3)" },
        3: { icon: "âš ï¸", color: "#ef4444", bg: "rgba(239,68,68,0.08)", border: "rgba(239,68,68,0.3)" },
      }[result.tier] || { icon: "ğŸ“…", color: "#94a3b8", bg: "rgba(148,163,184,0.08)", border: "rgba(148,163,184,0.3)" };

      // ìº¡ì³ ê¸°ëŠ¥
      const handleCapture = async () => {
        if (!captureRef.current || capturing) return;
        setCapturing(true);
        try {
          const canvas = await html2canvas(captureRef.current, {
            backgroundColor: "#0f172a",
            scale: 2,
            useCORS: true,
          });
          
          // í´ë¦½ë³´ë“œì— ë³µì‚¬
          canvas.toBlob(async (blob) => {
            try {
              await navigator.clipboard.write([
                new ClipboardItem({ 'image/png': blob })
              ]);
              alert('ğŸ“‹ ì´ë¯¸ì§€ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì¹´ì¹´ì˜¤í†¡, ë©”ëª¨ì¥ ë“±ì— ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.');
            } catch (err) {
              // í´ë¦½ë³´ë“œ API ì‹¤íŒ¨ ì‹œ ë‹¤ìš´ë¡œë“œë¡œ ëŒ€ì²´
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `${group?.groupName || 'ì•½ì†'}_ê²°ê³¼.png`;
              a.click();
              URL.revokeObjectURL(url);
              alert('ğŸ“¥ ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
          }, 'image/png');
        } catch (err) {
          console.error('Capture error:', err);
          alert('ìº¡ì³ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        } finally {
          setCapturing(false);
        }
      };

      const buildGcalUrl = () => {
        const d = parseDate(selectedDate);
        const [h, m] = (eventTime || defaultTime).split(":").map(Number);
        const start = new Date(d.getFullYear(), d.getMonth(), d.getDate(), h, m);
        const dur = parseFloat(eventDuration) || 2;
        const end = new Date(start.getTime() + dur * 60 * 60 * 1000);
        const fmt = (dt) => dt.toISOString().replace(/[-:]/g, "").replace(/\.\d{3}/, "");
        const title = encodeURIComponent(eventTitle || `${mealLabel} ì•½ì†`);
        return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${fmt(start)}/${fmt(end)}`;
      };

      return (
        <div>
          {/* ìº¡ì³ ì˜ì—­ ì‹œì‘ */}
          <div ref={captureRef} style={{ background: "linear-gradient(145deg, #0f172a 0%, #1e293b 50%, #0f172a 100%)", padding: "16px", borderRadius: 16 }}>
            <Card style={{ background: cfg.bg, border: `1px solid ${cfg.border}`, textAlign: "center" }}>
              {group && group.groupName && <div style={{ fontSize: 16, fontWeight: 700, color: "#e2e8f0", marginBottom: 6 }}>{group.groupName}</div>}
              <div style={{ fontSize: 13, color: "#94a3b8", marginBottom: 8 }}>{mealEmoji} {mealLabel} ì•½ì†</div>
              {result.vip && <div style={{ fontSize: 13, color: "#c084fc", marginBottom: 4 }}>ğŸ‘‘ {result.vip}ë‹˜ ì¤‘ì‹¬ìœ¼ë¡œ ì‚°ì¶œ</div>}
              <div style={{ fontSize: 48, marginBottom: 12 }}>{cfg.icon}</div>
              <div style={{ fontSize: 20, fontWeight: 800, marginBottom: 6, color: cfg.color }}>{result.message}</div>
              <div style={{ fontSize: 13, color: "#64748b" }}>
                ì°¸ì—¬ ì¸ì›: {result.totalMembers}ëª…
                {group && group.excluded && group.excluded.length > 0 && <span> (ì œì™¸: {group.excluded.join(", ")})</span>}
              </div>
              {result.fromFocus === false && <div style={{ fontSize: 12, color: "#f59e0b", marginTop: 6 }}>í•µì‹¬ êµ¬ê°„ì—ì„œ ê²°ê³¼ë¥¼ ì°¾ì§€ ëª»í•´ ì „ì²´ ë²”ìœ„ì—ì„œ ì‚°ì¶œí–ˆìŠµë‹ˆë‹¤</div>}
            </Card>

            {/* í›„ë³´ ë‚ ì§œ ë¦¬ìŠ¤íŠ¸ â€” ì„ íƒ ê°€ëŠ¥ */}
            <Card>
              <div style={{ fontSize: 13, color: "#94a3b8", marginBottom: 12 }}>
                {confirmedDate ? "âœ… í™•ì •ëœ ë‚ ì§œ" : "ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ ìº˜ë¦°ë”ì— ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”"}
              </div>
              <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                {result.dates.map((d, i) => {
                  const date = parseDate(d.date);
                  const isSelected = selectedDate === d.date;
                  const isConfirmed = confirmedDate === d.date;
                  return (
                    <button key={i} onClick={() => !confirmedDate && setSelectedDate(isSelected ? null : d.date)} style={{
                      padding: "16px 20px", borderRadius: 12, textAlign: "left",
                      background: isConfirmed ? "rgba(34,197,94,0.12)" : isSelected ? "rgba(56,189,248,0.1)" : "rgba(15,23,42,0.6)",
                      border: isConfirmed ? "2px solid #22c55e" : isSelected ? "2px solid #38bdf8" : `1px solid ${cfg.border}`,
                      cursor: confirmedDate ? "default" : "pointer", fontFamily: "inherit", transition: "all 0.15s",
                      opacity: confirmedDate && !isConfirmed ? 0.4 : 1,
                    }}>
                      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                        <div style={{ fontSize: 18, fontWeight: 800, color: isConfirmed ? "#22c55e" : isSelected ? "#38bdf8" : cfg.color }}>
                          {date ? fmtDisplay(date) : d.date}
                        </div>
                        {isConfirmed && <span style={{ fontSize: 13, color: "#22c55e", fontWeight: 600 }}>í™•ì •ë¨ âœ…</span>}
                        {!confirmedDate && isSelected && <span style={{ fontSize: 13, color: "#38bdf8", fontWeight: 600 }}>ì„ íƒë¨ âœ“</span>}
                      </div>
                      {result.tier === 2 && (
                        <div style={{ fontSize: 13, color: "#94a3b8", marginTop: 6 }}>
                          ì„ í˜¸ {d.preferred}ëª…
                          {d.neutralUsers && d.neutralUsers.length > 0 && <span style={{ color: "#f59e0b" }}> Â· ë¹„ì„ í˜¸: {d.neutralUsers.join(", ")}</span>}
                        </div>
                      )}
                      {result.tier === 3 && (
                        <div style={{ fontSize: 13, marginTop: 6 }}>
                          <div style={{ color: "#f87171", marginBottom: 2 }}>ì ˆëŒ€ë¶ˆê°€ {d.unavailable}ëª… ({d.unavailableUsers.join(", ")})</div>
                        <div style={{ color: "#94a3b8" }}>
                          ì„ í˜¸ {d.preferred}ëª…
                          {d.neutralUsers && d.neutralUsers.length > 0 && <span style={{ color: "#f59e0b" }}> Â· ë¹„ì„ í˜¸: {d.neutralUsers.join(", ")}</span>}
                        </div>
                      </div>
                    )}
                  </button>
                );
              })}
            </div>
          </Card>
          </div>
          {/* ìº¡ì³ ì˜ì—­ ë */}

          {/* ìº¡ì³/ê³µìœ  ë²„íŠ¼ */}
          <Card style={{ textAlign: "center" }}>
            <button onClick={handleCapture} disabled={capturing} style={{
              width: "100%", padding: "14px 20px", borderRadius: 12,
              background: "rgba(168,85,247,0.15)", border: "1px solid rgba(168,85,247,0.3)",
              color: "#c084fc", fontSize: 15, fontWeight: 700, cursor: capturing ? "default" : "pointer",
              opacity: capturing ? 0.6 : 1, fontFamily: "inherit",
            }}>
              {capturing ? "ìº¡ì³ ì¤‘..." : "ğŸ“‹ ê²°ê³¼ ì´ë¯¸ì§€ ë³µì‚¬í•˜ê¸°"}
            </button>
          </Card>

          {/* ë‚ ì§œ í™•ì • ë²„íŠ¼ â€” ë¯¸í™•ì • + ì„ íƒë¨ ìƒíƒœì¼ ë•Œ */}
          {!confirmedDate && selectedDate && (
            <Card style={{ textAlign: "center" }}>
              <div style={{ fontSize: 14, color: "#94a3b8", marginBottom: 12 }}>
                ì´ ë‚ ì§œë¡œ í™•ì •í•˜ë©´ ëª¨ë“  ì°¸ì—¬ìì—ê²Œ ë³´ì—¬ìš”
              </div>
              <button onClick={async () => {
                setConfirming(true);
                try {
                  await onConfirmDate(selectedDate);
                } finally { setConfirming(false); }
              }} disabled={confirming} style={{
                width: "100%", padding: "14px 20px", borderRadius: 12, border: "none",
                background: "linear-gradient(135deg,#22c55e,#16a34a)", color: "#fff",
                fontSize: 15, fontWeight: 700, cursor: confirming ? "default" : "pointer",
                opacity: confirming ? 0.6 : 1, fontFamily: "inherit",
              }}>
                {confirming ? "í™•ì • ì¤‘..." : `âœ… ${fmtDisplay(parseDate(selectedDate))} í™•ì •í•˜ê¸°`}
              </button>
            </Card>
          )}

          {/* êµ¬ê¸€ ìº˜ë¦°ë” ì¶”ê°€ â€” ë‚ ì§œ ì„ íƒ ë˜ëŠ” í™•ì • ì‹œ í‘œì‹œ */}
          {(selectedDate || confirmedDate) && (
            <Card style={{ background: "rgba(56,189,248,0.06)", border: "1px solid rgba(56,189,248,0.25)" }}>
              <div style={{ fontSize: 16, fontWeight: 700, marginBottom: 16 }}>ğŸ“… ìº˜ë¦°ë”ì— ì¶”ê°€</div>
              <div style={{ marginBottom: 12 }}>
                <label style={{ fontSize: 13, color: "#94a3b8", display: "block", marginBottom: 6 }}>ëª¨ì„ ì œëª©</label>
                <input type="text" value={eventTitle} onChange={e => setEventTitle(e.target.value)}
                  placeholder={`${mealLabel} ì•½ì†`} style={inputStyle} />
              </div>
              <div style={{ display: "flex", gap: 10, marginBottom: 16 }}>
                <div style={{ flex: 1 }}>
                  <label style={{ fontSize: 13, color: "#94a3b8", display: "block", marginBottom: 6 }}>ì‹œì‘ ì‹œê°„</label>
                  <input type="time" value={eventTime || defaultTime} onChange={e => setEventTime(e.target.value)} style={inputStyle} />
                </div>
                <div style={{ flex: 1 }}>
                  <label style={{ fontSize: 13, color: "#94a3b8", display: "block", marginBottom: 6 }}>ì†Œìš” ì‹œê°„</label>
                  <select value={eventDuration} onChange={e => setEventDuration(e.target.value)} style={{...inputStyle, cursor: "pointer"}}>
                    <option value="1">1ì‹œê°„</option>
                    <option value="1.5">1ì‹œê°„ 30ë¶„</option>
                    <option value="2">2ì‹œê°„</option>
                    <option value="2.5">2ì‹œê°„ 30ë¶„</option>
                    <option value="3">3ì‹œê°„</option>
                    <option value="4">4ì‹œê°„</option>
                  </select>
                </div>
              </div>
              <button onClick={() => { setGcalLink(buildGcalUrl()); setLinkCopied(false); }} style={{
                display: "block", width: "100%", padding: "14px 20px", borderRadius: 12,
                background: "linear-gradient(135deg,#0ea5e9,#38bdf8)", color: "#fff",
                fontSize: 15, fontWeight: 700, textAlign: "center", border: "none",
                cursor: "pointer", fontFamily: "inherit",
              }}>
                ğŸ“… ìº˜ë¦°ë” ë§í¬ ìƒì„±í•˜ê¸°
              </button>

              {gcalLink && (
                <div style={{ marginTop: 12, padding: "14px 16px", borderRadius: 10, background: "rgba(15,23,42,0.6)", border: "1px solid rgba(56,189,248,0.3)" }}>
                  <div style={{ fontSize: 12, color: "#64748b", marginBottom: 8 }}>ì•„ë˜ ë§í¬ë¥¼ ê³µìœ í•˜ë©´ ëˆ„êµ¬ë‚˜ ìê¸° ìº˜ë¦°ë”ì— ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”</div>
                  <div style={{ display: "flex", alignItems: "center", gap: 8 }}>
                    <a href={gcalLink} target="_blank" rel="noopener noreferrer" style={{
                      flex: 1, fontSize: 13, color: "#38bdf8", wordBreak: "break-all",
                      textDecoration: "underline", overflow: "hidden",
                      display: "-webkit-box", WebkitLineClamp: 2, WebkitBoxOrient: "vertical",
                    }}>{gcalLink}</a>
                    <button onClick={() => {
                      navigator.clipboard.writeText(gcalLink).then(() => {
                        setLinkCopied(true); setTimeout(() => setLinkCopied(false), 2000);
                      });
                    }} style={{
                      flexShrink: 0, padding: "8px 14px", borderRadius: 8,
                      background: linkCopied ? "rgba(34,197,94,0.15)" : "rgba(56,189,248,0.15)",
                      border: linkCopied ? "1px solid rgba(34,197,94,0.3)" : "1px solid rgba(56,189,248,0.3)",
                      color: linkCopied ? "#22c55e" : "#38bdf8",
                      fontSize: 13, fontWeight: 600, cursor: "pointer", fontFamily: "inherit",
                    }}>
                      {linkCopied ? "ë³µì‚¬ë¨ âœ“" : "ë³µì‚¬"}
                    </button>
                  </div>
                </div>
              )}
            </Card>
          )}
        </div>
      );
    }

    // â”€â”€ ë©”ì¸ ì•± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function App() {
      const [screen, setScreen] = useState("loading");
      const [groupId, setGroupId] = useState(null);
      const [group, setGroup] = useState(null);
      const [userName, setUserName] = useState(null);
      const [votes, setVotes] = useState({});
      const loadIdRef = React.useRef(0);
      const [saving, setSaving] = useState(false);
      const [loading, setLoading] = useState(false);
      const [result, setResult] = useState(null);
      const [voteStatus, setVoteStatus] = useState(null);
      const [createForm, setCreateForm] = useState({ creator: "", members: "", focusRanges: [], mealType: "dinner", groupName: "", email: "" });
      const [createdLink, setCreatedLink] = useState(null);
      const [error, setError] = useState(null);
      const [mealType, setMealType] = useState("dinner");
      const [vipName, setVipName] = useState("");

      useEffect(() => {
        const p = new URLSearchParams(window.location.search);
        const gId = p.get("g");
        const m = p.get("m");
        if (m === "lunch") setMealType("lunch");
        if (gId) { setGroupId(gId); setScreen("loadingGroup"); }
        else { setScreen("create"); }
      }, []);

      useEffect(() => {
        if (screen !== "loadingGroup" || !groupId) return;
        setLoading(true);
        apiCall({ action: "getGroup", groupId })
          .then(data => {
            if (data.error) { setError("ê·¸ë£¹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"); setScreen("error"); }
            else {
              const g = data.group;
              // focusRanges íŒŒì‹± (í•˜ìœ„ í˜¸í™˜: ê¸°ì¡´ focusStart/Endë„ ì¸ì‹)
              let fr = [];
              if (g.focusRanges) {
                try { fr = typeof g.focusRanges === "string" ? JSON.parse(g.focusRanges) : g.focusRanges; } catch(e) { fr = []; }
              } else if (g.focusStart && g.focusEnd) {
                fr = [{ s: g.focusStart, e: g.focusEnd }];
              }
              setGroup({...g, focusRanges: fr, mealType});
              setScreen(g.status === "closed" ? "resultLoading" : "selectName");
            }
          })
          .catch(() => { setError("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"); setScreen("error"); })
          .finally(() => setLoading(false));
      }, [screen, groupId]);

      useEffect(() => {
        if (screen !== "resultLoading" || !groupId) return;
        const params = { action: "getResult", groupId };
        if (vipName) params.vip = vipName;
        apiCall(params)
          .then(data => { setResult(data); setScreen("result"); })
          .catch(() => { setError("ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"); setScreen("error"); });
      }, [screen, groupId, vipName]);

      const userModifiedRef = React.useRef(false);

      const loadMyVotes = useCallback((name) => {
        const thisId = ++loadIdRef.current;
        userModifiedRef.current = false;
        apiCall({ action: "getMyVotes", groupId, userName: name })
          .then(data => {
            // ì´ë¯¸ ì‚¬ìš©ìê°€ ìˆ˜ì •í–ˆê±°ë‚˜ ë” ìƒˆë¡œìš´ ìš”ì²­ì´ ìˆìœ¼ë©´ ë¬´ì‹œ
            if (userModifiedRef.current || thisId !== loadIdRef.current) return;
            const vm = {};
            if (data.votes) data.votes.forEach(v => { const d = parseDate(v.date); if (d) vm[fmtDate(d)] = v.voteType; });
            setVotes(vm);
          });
      }, [groupId]);

      const handleCreate = async () => {
        if (!createForm.creator.trim() || !createForm.members.trim()) return;
        setLoading(true);
        try {
          const all = createForm.members.split(",").map(s=>s.trim()).filter(Boolean);
          if (!all.includes(createForm.creator.trim())) all.unshift(createForm.creator.trim());
          const data = await apiCall({
            action: "createGroup",
            creator: createForm.creator.trim(),
            members: all.join(","),
            focusRanges: JSON.stringify(createForm.focusRanges || []),
            groupName: createForm.groupName.trim(),
            email: createForm.email.trim(),
          });
          if (data.success) {
            const meal = createForm.mealType || "dinner";
            const mParam = meal === "lunch" ? "&m=lunch" : "";
            const link = `${window.location.origin}${window.location.pathname}?g=${data.groupId}${mParam}`;
            setCreatedLink(link); setScreen("created");
          }
        } catch { setError("ê·¸ë£¹ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"); setScreen("error"); }
        finally { setLoading(false); }
      };

      const handleSave = async () => {
        setSaving(true);
        try {
          const arr = Object.entries(votes).map(([date,voteType]) => ({date,voteType}));
          await apiCall({ action: "saveVotes", groupId, userName, votes: JSON.stringify(arr) });
        } finally { setSaving(false); }
      };

      const loadVoteStatus = async () => { const data = await apiCall({ action: "getVoteStatus", groupId }); setVoteStatus(data); };

      const handleClose = async (excluded, vip) => {
        setLoading(true);
        setVipName(vip || "");
        try { await apiCall({ action: "closeGroup", groupId, excluded: excluded.join(","), vip: vip || "" }); setScreen("resultLoading"); }
        finally { setLoading(false); }
      };

      const handleUpdateFocus = async (focusRanges) => {
        await apiCall({ action: "updateFocus", groupId, focusRanges: JSON.stringify(focusRanges) });
        setGroup({ ...group, focusRanges });
      };

      const handleConfirmDate = async (date) => {
        await apiCall({ action: "confirmDate", groupId, date });
        setGroup({ ...group, confirmedDate: date });
      };

      return (
        <div style={{ maxWidth: 480, margin: "0 auto", padding: "0 16px" }}>
          <Header />
          {(screen === "loading" || screen === "loadingGroup" || screen === "resultLoading") && <LoadingSpinner />}
          {screen === "error" && <ErrorScreen message={error} />}
          {screen === "create" && <CreateScreen form={createForm} setForm={setCreateForm} onSubmit={handleCreate} loading={loading} />}
          {screen === "created" && <CreatedScreen link={createdLink} />}
          {screen === "selectName" && group && <SelectNameScreen group={group} onSelect={name => { setUserName(name); loadMyVotes(name); setScreen("calendar"); }} />}
          {screen === "calendar" && group && <CalendarScreen group={group} userName={userName} votes={votes} setVotes={(fn) => { userModifiedRef.current = true; setVotes(fn); }} onSave={handleSave} saving={saving} loading={loading} onManage={() => { loadVoteStatus(); setScreen("manage"); }} isCreator={userName === group.creator} onBack={() => setScreen("selectName")} onUpdateFocus={handleUpdateFocus} />}
          {screen === "manage" && group && <ManageScreen group={group} voteStatus={voteStatus} onClose={handleClose} onBack={() => setScreen("calendar")} loading={loading} onRefresh={loadVoteStatus} onUpdateFocus={handleUpdateFocus} />}
          {screen === "result" && result && <ResultScreen result={result} group={group} onConfirmDate={handleConfirmDate} />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
